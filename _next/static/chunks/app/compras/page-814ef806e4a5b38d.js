(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{72894:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},98253:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},13008:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},83523:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},9224:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},41298:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},76637:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},64280:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},92851:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]])},31541:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(62898).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},34648:function(e,a,t){Promise.resolve().then(t.bind(t,8353))},8353:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return S}});var r=t(57437),s=t(2265),o=t(31541),n=t(76637),l=t(41298),i=t(98253),c=t(11961),d=t(41827),u=t(9224),m=t(83523),x=t(4322),h=t(45367),p=t(13008),v=t(72894),f=t(9883),j=t(64280),N=t(66651),g=t(70492),y=t(548),w=t(40971),b=t(87431),k=t(22169),_=t(14958);let C=[{value:"dinheiro",label:"Dinheiro"},{value:"pix",label:"PIX"},{value:"debito",label:"Cart\xe3o D\xe9bito"},{value:"credito",label:"Cart\xe3o Cr\xe9dito"},{value:"boleto",label:"Boleto"},{value:"transferencia",label:"Transfer\xeancia"}];function S(){let[e,a]=(0,s.useState)([]),[t,S]=(0,s.useState)([]),[E,q]=(0,s.useState)([]),[z,F]=(0,s.useState)([]),[Z,M]=(0,s.useState)(!0),[I,T]=(0,s.useState)(!1),[L,P]=(0,s.useState)(""),[D,O]=(0,s.useState)(null),[A,G]=(0,s.useState)(!1),[V,U]=(0,s.useState)(!1),[J,X]=(0,s.useState)(null),[R,Q]=(0,s.useState)(null),[H,B]=(0,s.useState)(!1),[Y,K]=(0,s.useState)(null),[W,$]=(0,s.useState)(!1),[ee,ea]=(0,s.useState)(null),[et,er]=(0,s.useState)(!1),[es,eo]=(0,s.useState)(""),[en,el]=(0,s.useState)(null),[ei,ec]=(0,s.useState)("upload"),[ed,eu]=(0,s.useState)(null),[em,ex]=(0,s.useState)(!1),[eh,ep]=(0,s.useState)("boleto"),[ev,ef]=(0,s.useState)(null),[ej,eN]=(0,s.useState)(!0),[eg,ey]=(0,s.useState)(!0),[ew,eb]=(0,s.useState)(""),[ek,e_]=(0,s.useState)(!0),[eC,eS]=(0,s.useState)(!1),[eE,eq]=(0,s.useState)(""),[ez,eF]=(0,s.useState)(!1),[eZ,eM]=(0,s.useState)([]),[eI,eT]=(0,s.useState)(!1),[eL,eP]=(0,s.useState)(null),[eD,eO]=(0,s.useState)(null),[eA,eG]=(0,s.useState)(new Map),[eV,eU]=(0,s.useState)(!1),[eJ,eX]=(0,s.useState)({}),[eR,eQ]=(0,s.useState)({}),[eH,eB]=(0,s.useState)({}),[eY,eK]=(0,s.useState)(null),eW=(0,s.useRef)({}),[e$,e0]=(0,s.useState)(!1),[e1,e2]=(0,s.useState)([]),[e4,e5]=(0,s.useState)(null),[e3,e8]=(0,s.useState)(!1),e6=(0,s.useRef)(null);(0,s.useEffect)(()=>{e7()},[]),(0,s.useEffect)(()=>{let e=e=>{if(null!==eY){let a=eW.current[eY];a&&!a.contains(e.target)&&eK(null)}};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[eY]);let e7=async()=>{try{M(!0);let[e,t,r,s]=await Promise.all([(0,b.TM)(),(0,b.Xh)(),(0,b.Df)(),(0,b.SJ)("despesa")]);a(e),S(t),q(r),F(s);let o=s.find(e=>e.nome.toLowerCase().includes("despesa de material")||e.nome.toLowerCase().includes("material"));o&&!ev&&ef(o.id)}catch(e){console.error("Erro ao carregar dados:",e)}finally{M(!1)}},e9=async()=>{if(Y){$(!0),ea(null);try{let e=await (0,b.fz)(Y.id);ea(e),e.success&&setTimeout(async()=>{await e7(),B(!1),K(null),ea(null),O(null)},1500)}catch(e){ea({success:!1,message:"Erro ao excluir: "+(e instanceof Error?e.message:"Erro desconhecido")})}finally{$(!1)}}},ae=(e,a)=>{a.stopPropagation(),K(e),ea(null),B(!0)},aa=e.filter(e=>{var a,t,r;return(null===(a=e.numero)||void 0===a?void 0:a.includes(L))||(null===(t=e.fornecedor_razao_social)||void 0===t?void 0:t.toLowerCase().includes(L.toLowerCase()))||(null===(r=e.chave_acesso)||void 0===r?void 0:r.includes(L))}),at=e=>{try{var a,t,r,s,o,n,l,i,c,d,u,m,x,h,p,v,f,j,N,g,y;let w=new DOMParser().parseFromString(e,"text/xml"),b=w.querySelector("ide"),_=w.querySelector("emit"),C=w.querySelector("total ICMSTot"),S=w.querySelectorAll("det"),E=[];S.forEach(e=>{let a=e.querySelector("prod");if(a){var t,r,s,o,n,l,i,c,d,u;E.push({codigo:(null===(t=a.querySelector("cProd"))||void 0===t?void 0:t.textContent)||"",descricao:(null===(r=a.querySelector("xProd"))||void 0===r?void 0:r.textContent)||"",ncm:(null===(s=a.querySelector("NCM"))||void 0===s?void 0:s.textContent)||"",cfop:(null===(o=a.querySelector("CFOP"))||void 0===o?void 0:o.textContent)||"",unidade:(0,k.zm)(null===(n=a.querySelector("uCom"))||void 0===n?void 0:n.textContent),quantidade:parseFloat((null===(l=a.querySelector("qCom"))||void 0===l?void 0:l.textContent)||"0"),valorUnitario:parseFloat((null===(i=a.querySelector("vUnCom"))||void 0===i?void 0:i.textContent)||"0"),valorTotal:parseFloat((null===(c=a.querySelector("vProd"))||void 0===c?void 0:c.textContent)||"0"),gtin:(null===(d=a.querySelector("cEAN"))||void 0===d?void 0:d.textContent)||(null===(u=a.querySelector("cEANTrib"))||void 0===u?void 0:u.textContent)||""})}});let q=null==_?void 0:_.querySelector("enderEmit");return{numero:(null==b?void 0:null===(a=b.querySelector("nNF"))||void 0===a?void 0:a.textContent)||"",serie:(null==b?void 0:null===(t=b.querySelector("serie"))||void 0===t?void 0:t.textContent)||"",chaveAcesso:(null===(s=w.querySelector("infNFe"))||void 0===s?void 0:null===(r=s.getAttribute("Id"))||void 0===r?void 0:r.replace("NFe",""))||"",dataEmissao:(null==b?void 0:null===(n=b.querySelector("dhEmi"))||void 0===n?void 0:null===(o=n.textContent)||void 0===o?void 0:o.split("T")[0])||"",fornecedor:{cnpj:(null==_?void 0:null===(l=_.querySelector("CNPJ"))||void 0===l?void 0:l.textContent)||"",razaoSocial:(null==_?void 0:null===(i=_.querySelector("xNome"))||void 0===i?void 0:i.textContent)||"",nomeFantasia:(null==_?void 0:null===(c=_.querySelector("xFant"))||void 0===c?void 0:c.textContent)||"",inscricaoEstadual:(null==_?void 0:null===(d=_.querySelector("IE"))||void 0===d?void 0:d.textContent)||"",endereco:(null==q?void 0:null===(u=q.querySelector("xLgr"))||void 0===u?void 0:u.textContent)||"",numero:(null==q?void 0:null===(m=q.querySelector("nro"))||void 0===m?void 0:m.textContent)||"",bairro:(null==q?void 0:null===(x=q.querySelector("xBairro"))||void 0===x?void 0:x.textContent)||"",cidade:(null==q?void 0:null===(h=q.querySelector("xMun"))||void 0===h?void 0:h.textContent)||"",estado:(null==q?void 0:null===(p=q.querySelector("UF"))||void 0===p?void 0:p.textContent)||"",cep:(null==q?void 0:null===(v=q.querySelector("CEP"))||void 0===v?void 0:v.textContent)||"",telefone:(null==q?void 0:null===(f=q.querySelector("fone"))||void 0===f?void 0:f.textContent)||""},valorProdutos:parseFloat((null==C?void 0:null===(j=C.querySelector("vProd"))||void 0===j?void 0:j.textContent)||"0"),valorFrete:parseFloat((null==C?void 0:null===(N=C.querySelector("vFrete"))||void 0===N?void 0:N.textContent)||"0"),valorDesconto:parseFloat((null==C?void 0:null===(g=C.querySelector("vDesc"))||void 0===g?void 0:g.textContent)||"0"),valorTotal:parseFloat((null==C?void 0:null===(y=C.querySelector("vNF"))||void 0===y?void 0:y.textContent)||"0"),produtos:E}}catch(e){return console.error("Erro ao parsear XML:",e),null}},ar=async e=>{var a;let t=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!t)return;let r=new FileReader;r.onload=async e=>{var a;let t=null===(a=e.target)||void 0===a?void 0:a.result;eo(t);let r=at(t);if(r){if(r.chaveAcesso){let e=await (0,b.eB)(r.chaveAcesso);if(e){alert("⚠️ Esta nota fiscal j\xe1 foi importada!\n\nN\xfamero: ".concat(e.numero,"\nFornecedor: ").concat(e.fornecedor_razao_social,"\nData de Entrada: ").concat((0,k.p6)(e.data_entrada),"\n\nA nota n\xe3o pode ser importada novamente para evitar duplica\xe7\xe3o no estoque.\n\nSe voc\xea excluiu a nota e quer importar novamente, verifique se ela foi removida completamente do sistema.")),e6.current&&(e6.current.value="");return}}eu(await (0,b.GZ)(r.fornecedor.cnpj)),el(r),eU(!0);let e=new Map;for(let a=0;a<r.produtos.length;a++){let t=r.produtos[a],s={codigo:t.codigo,descricao:t.descricao,ncm:t.ncm,cfop:t.cfop,unidade:t.unidade,quantidade:t.quantidade,valorUnitario:t.valorUnitario,valorTotal:t.valorTotal,gtin:t.gtin},o=await (0,b.V3)(s);e.set(a,{existente:!!o,produtoDb:o||void 0})}eG(e),eU(!1),ec("produtos")}else alert("Erro ao processar XML. Verifique se o arquivo \xe9 v\xe1lido.")},r.readAsText(t)},as=async()=>{if(en){for(let e=0;e<en.produtos.length;e++)if("vincular"===(eJ[e]||"auto")&&!eR[e]){alert('Por favor, selecione um produto existente para vincular ao item "'.concat(en.produtos[e].descricao,'" ou escolha outra op\xe7\xe3o.'));return}T(!0);try{if(en.chaveAcesso){let e=await (0,b.eB)(en.chaveAcesso);if(e){alert("⚠️ Esta nota fiscal j\xe1 foi importada anteriormente!\n\nN\xfamero: ".concat(e.numero,"\nData: ").concat((0,k.p6)(e.data_entrada),"\n\nPara evitar duplica\xe7\xe3o de estoque, a importa\xe7\xe3o foi cancelada.")),T(!1);return}}let e=null==ed?void 0:ed.id;ed||(e=(await (0,b.gO)({razao_social:en.fornecedor.razaoSocial,nome_fantasia:en.fornecedor.nomeFantasia,cnpj:en.fornecedor.cnpj,inscricao_estadual:en.fornecedor.inscricaoEstadual,endereco:en.fornecedor.endereco,numero:en.fornecedor.numero,bairro:en.fornecedor.bairro,cidade:en.fornecedor.cidade,estado:en.fornecedor.estado,cep:en.fornecedor.cep,telefone:en.fornecedor.telefone,ativo:!0})).id);let a=await (0,b.Fd)({numero:en.numero,serie:en.serie,chave_acesso:en.chaveAcesso,data_emissao:en.dataEmissao,data_entrada:new Date().toISOString().split("T")[0],fornecedor_id:e,fornecedor_cnpj:en.fornecedor.cnpj,fornecedor_razao_social:en.fornecedor.razaoSocial,valor_produtos:en.valorProdutos,valor_frete:en.valorFrete,valor_desconto:en.valorDesconto,valor_total:en.valorTotal,forma_pagamento:eh,lancado_caixa:em,xml_original:es,status:"processada"}),r=[];for(let s=0;s<en.produtos.length;s++){let o,n;let l=en.produtos[s],i=eJ[s]||"auto";if("ignorar"===i){r.push({descricao:l.descricao,acao:"ignorado"});continue}let c={codigo:l.codigo,descricao:l.descricao,ncm:l.ncm,cfop:l.cfop,unidade:l.unidade,quantidade:l.quantidade,valorUnitario:l.valorUnitario,valorTotal:l.valorTotal,gtin:l.gtin};if("vincular"===i&&eR[s]){let e=eR[s],a=l.valorUnitario,r={valor_custo:a,custo_ultima_compra:a,custo_medio:a,updated_at:new Date().toISOString()};if(ek){let s=t.find(a=>a.id===e);(null==s?void 0:s.margem_lucro)&&s.margem_lucro>0&&(r.valor_venda=a*(1+s.margem_lucro/100))}let{error:i}=await _.OQ.from("produtos").update(r).eq("id",e);if(i)throw Error("Erro ao atualizar produto vinculado: ".concat(i.message));o=e,n="vinculado"}else if("cadastrar"===i){let a=l.valorUnitario,{data:t,error:r}=await _.OQ.from("produtos").insert([{codigo:l.codigo||null,nome:l.descricao,ncm:l.ncm||null,cfop:l.cfop||null,unidade:l.unidade,valor_custo:a,valor_venda:a,custo_medio:a,custo_ultima_compra:a,margem_lucro:0,quantidade_estoque:0,fornecedor_id:e,ativo:!0}]).select().single();if(r)throw Error("Erro ao criar produto: ".concat(r.message));o=t.id,n="criado"}else{let a=await (0,b.Js)(c,ek,e);o=a.produtoId,n="criado"===a.acao?"criado":"atualizado"}r.push({descricao:l.descricao,acao:n}),await (0,b.Wr)({nota_fiscal_id:a.id,produto_id:o,codigo_produto_nf:l.codigo,descricao:l.descricao,ncm:l.ncm,cfop:l.cfop,unidade:l.unidade,quantidade:l.quantidade,valor_unitario:l.valorUnitario,valor_total:l.valorTotal,valor_desconto:0,acao:"criado"===n?"cadastrado":"existente"}),ej&&await (0,b.QV)({produto_id:o,tipo:"entrada",quantidade:l.quantidade,valor_unitario:l.valorUnitario,valor_total:l.valorTotal,nota_fiscal_id:a.id,motivo:"Entrada NF ".concat(en.numero).concat("vinculado"===n?" (vinculado manualmente)":""),data_movimentacao:new Date().toISOString()})}if(em&&ev){let t="NF ".concat(en.numero," - ").concat(en.fornecedor.razaoSocial),{candidatos:r,melhorMatch:s}=await (0,b.gy)({data_nf:en.dataEmissao,valor:en.valorTotal,descricao_xml:t,fornecedor_nome:en.fornecedor.razaoSocial});if(s){console.log("✓ Match encontrado: Lan\xe7amento #".concat(s.id," (score: ").concat((100*s.score).toFixed(0),"%)"));let r=await (0,b.J4)({lancamento_id:s.id,nota_fiscal_entrada_id:a.id,numero_nf:en.numero,fornecedor_nome:en.fornecedor.razaoSocial,categoria_id:ev,forma_pagamento:eh});r.success||(console.error("Erro na reconcilia\xe7\xe3o:",r.error),await (0,b.ZH)({tipo:"despesa",categoria_id:ev,valor:en.valorTotal,data_lancamento:new Date().toISOString().split("T")[0],forma_pagamento:eh,fornecedor_id:e,nota_fiscal_entrada_id:a.id,descricao:t,com_nota_fiscal:!0,conciliado:!1}))}else if(r.length>1){eM(r),eO({notaId:a.id,numero:en.numero,fornecedorNome:en.fornecedor.razaoSocial,categoriaId:ev,formaPagamento:eh}),eT(!0),T(!1);return}else await (0,b.ZH)({tipo:"despesa",categoria_id:ev,valor:en.valorTotal,data_lancamento:new Date().toISOString().split("T")[0],forma_pagamento:eh,fornecedor_id:e,nota_fiscal_entrada_id:a.id,descricao:t,com_nota_fiscal:!0,conciliado:!1})}eg&&("boleto"===eh||!em)&&await (0,b.NV)({fornecedor_id:e,descricao:"NF ".concat(en.numero," - ").concat(en.fornecedor.razaoSocial),valor:en.valorTotal,valor_pago:0,data_emissao:en.dataEmissao,data_vencimento:ew||en.dataEmissao,nota_fiscal_id:a.id,status:"pendente",forma_pagamento:eh,com_nota_fiscal:!0});let s=r.filter(e=>"criado"===e.acao).length,o=r.filter(e=>"atualizado"===e.acao).length;await e7(),an(),alert("Nota fiscal importada com sucesso!\n\n• ".concat(s," produto(s) criado(s)\n• ").concat(o," produto(s) atualizado(s)"))}catch(e){console.error("Erro ao processar importa\xe7\xe3o:",e),alert("Erro ao processar importa\xe7\xe3o: "+(e instanceof Error?e.message:"Erro desconhecido"))}finally{T(!1)}}},ao=async e=>{if(eD){T(!0);try{if(null!==e){let a=await (0,b.J4)({lancamento_id:e,nota_fiscal_entrada_id:eD.notaId,numero_nf:eD.numero,fornecedor_nome:eD.fornecedorNome,categoria_id:eD.categoriaId,forma_pagamento:eD.formaPagamento});if(a.success)alert("Lan\xe7amento reconciliado com sucesso!\n\nO lan\xe7amento OFX existente foi atualizado com os dados da NF ".concat(eD.numero,"."));else throw Error(a.error||"Erro desconhecido")}else{var a;await (0,b.ZH)({tipo:"despesa",categoria_id:eD.categoriaId,valor:(null==en?void 0:en.valorTotal)||0,data_lancamento:new Date().toISOString().split("T")[0],forma_pagamento:eD.formaPagamento,fornecedor_id:(null===(a=E.find(e=>e.razao_social===eD.fornecedorNome||e.nome_fantasia===eD.fornecedorNome))||void 0===a?void 0:a.id)||null,nota_fiscal_entrada_id:eD.notaId,descricao:"NF ".concat(eD.numero," - ").concat(eD.fornecedorNome),com_nota_fiscal:!0,conciliado:!1})}await e7(),eT(!1),eM([]),eO(null),an()}catch(e){console.error("Erro ao processar reconcilia\xe7\xe3o:",e),alert("Erro ao processar: "+(e instanceof Error?e.message:"Erro desconhecido"))}finally{T(!1)}}},an=()=>{er(!1),eo(""),el(null),ec("upload"),eu(null),ex(!1),ep("boleto"),ef(null),eN(!0),ey(!0),eb(""),e_(!0),eM([]),eT(!1),eO(null),eG(new Map),eU(!1),eX({}),eQ({}),e6.current&&(e6.current.value="")},al=async(e,a)=>{a.stopPropagation(),e5(e),e8(!0),e0(!0);try{let a=await (0,b.$_)(e.id);e2(a)}catch(e){console.error("Erro ao buscar produtos da nota:",e),alert("Erro ao carregar produtos da nota")}finally{e8(!1)}},ai=()=>{e0(!1),e2([]),e5(null)};return Z?(0,r.jsx)("div",{className:"flex items-center justify-center h-[60vh]",children:(0,r.jsx)(y.TK,{size:"lg"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl lg:text-3xl font-bold font-heading text-white",children:"Compras / Entrada de Mercadoria"}),(0,r.jsx)("p",{className:"text-dark-400 mt-1",children:"Importe notas fiscais (XML) e gerencie entradas"})]}),(0,r.jsx)(N.z,{onClick:()=>er(!0),leftIcon:(0,r.jsx)(o.Z,{className:"w-5 h-5"}),children:"Importar XML"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsx)("div",{className:"glass-card p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center",children:(0,r.jsx)(n.Z,{className:"w-5 h-5 text-primary-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400 text-sm",children:"Total de Notas"}),(0,r.jsx)("p",{className:"text-xl font-bold text-white",children:e.length})]})]})}),(0,r.jsx)("div",{className:"glass-card p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center",children:(0,r.jsx)(l.Z,{className:"w-5 h-5 text-green-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400 text-sm",children:"Total Compras (M\xeas)"}),(0,r.jsx)("p",{className:"text-xl font-bold text-white",children:(0,k.xG)(e.filter(e=>new Date(e.data_entrada).getMonth()===new Date().getMonth()).reduce((e,a)=>e+a.valor_total,0))})]})]})}),(0,r.jsx)("div",{className:"glass-card p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center",children:(0,r.jsx)(i.Z,{className:"w-5 h-5 text-blue-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400 text-sm",children:"Fornecedores"}),(0,r.jsx)("p",{className:"text-xl font-bold text-white",children:E.length})]})]})}),(0,r.jsx)("div",{className:"glass-card p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center",children:(0,r.jsx)(c.Z,{className:"w-5 h-5 text-yellow-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400 text-sm",children:"Total Frete"}),(0,r.jsx)("p",{className:"text-xl font-bold text-white",children:(0,k.xG)(e.reduce((e,a)=>e+a.valor_frete,0))})]})]})})]}),(0,r.jsx)("div",{className:"glass-card p-4",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(d.Z,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-400"}),(0,r.jsx)("input",{type:"text",placeholder:"Buscar por n\xfamero, fornecedor ou chave de acesso...",value:L,onChange:e=>P(e.target.value),className:"input pl-12 w-full"})]})}),(0,r.jsx)("div",{className:"glass-card overflow-hidden",children:aa.length>0?(0,r.jsx)("div",{className:"divide-y divide-dark-700",children:aa.map(e=>{var a;return(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>O(D===e.id?null:e.id),children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-lg bg-primary-500/10 flex items-center justify-center",children:(0,r.jsx)(n.Z,{className:"w-6 h-6 text-primary-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"font-medium text-white",children:["NF ",e.numero]}),(0,r.jsx)(y.Ct,{variant:"success",children:"Processada"})]}),(0,r.jsx)("p",{className:"text-sm text-dark-400",children:e.fornecedor_id?(0,r.jsx)("button",{onClick:a=>{a.stopPropagation(),X(e.fornecedor_id),G(!0)},className:"text-primary-400 hover:text-primary-300 transition-colors",children:e.fornecedor_razao_social}):e.fornecedor_razao_social})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-lg font-bold text-white",children:(0,k.xG)(e.valor_total)}),(0,r.jsx)("p",{className:"text-xs text-dark-400",children:new Date(e.data_entrada).toLocaleDateString("pt-BR")})]}),D===e.id?(0,r.jsx)(u.Z,{className:"w-5 h-5 text-dark-400"}):(0,r.jsx)(m.Z,{className:"w-5 h-5 text-dark-400"})]})]}),D===e.id&&(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t border-dark-700",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-dark-400",children:"S\xe9rie"}),(0,r.jsx)("p",{className:"text-white",children:e.serie})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-dark-400",children:"Data Emiss\xe3o"}),(0,r.jsx)("p",{className:"text-white",children:e.data_emissao?new Date(e.data_emissao).toLocaleDateString("pt-BR"):"-"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-dark-400",children:"Valor Produtos"}),(0,r.jsx)("p",{className:"text-white",children:(0,k.xG)(e.valor_produtos)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-dark-400",children:"Valor Frete"}),(0,r.jsx)("p",{className:"text-white",children:(0,k.xG)(e.valor_frete)})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-dark-400 mb-1",children:"Chave de Acesso"}),(0,r.jsx)("p",{className:"text-xs text-dark-300 font-mono break-all",children:e.chave_acesso})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(y.Ct,{variant:e.lancado_caixa?"success":"secondary",children:e.lancado_caixa?"Lan\xe7ado no Caixa":"N\xe3o lan\xe7ado"}),e.forma_pagamento&&(0,r.jsx)(y.Ct,{variant:"primary",children:(null===(a=C.find(a=>a.value===e.forma_pagamento))||void 0===a?void 0:a.label)||e.forma_pagamento})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(N.z,{variant:"secondary",size:"sm",onClick:a=>al(e,a),leftIcon:(0,r.jsx)(x.Z,{className:"w-4 h-4"}),children:"Ver Produtos"}),(0,r.jsx)(N.z,{variant:"danger",size:"sm",onClick:a=>ae(e,a),leftIcon:(0,r.jsx)(h.Z,{className:"w-4 h-4"}),children:"Excluir NF"})]})]})]})]},e.id)})}):(0,r.jsx)(y.ub,{icon:(0,r.jsx)(n.Z,{className:"w-10 h-10 text-dark-500"}),title:"Nenhuma nota fiscal",description:"Importe arquivos XML de notas fiscais",action:(0,r.jsx)(N.z,{onClick:()=>er(!0),leftIcon:(0,r.jsx)(o.Z,{className:"w-4 h-4"}),children:"Importar XML"})})}),(0,r.jsx)(g.u,{isOpen:et,onClose:an,title:"Importar Nota Fiscal (XML)",size:"xl",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-center gap-2",children:["upload","produtos","pagamento","confirmar"].map((e,a)=>(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(ei===e?"bg-primary-500 text-white":["upload","produtos","pagamento","confirmar"].indexOf(ei)>a?"bg-green-500 text-white":"bg-dark-700 text-dark-400"),children:a+1}),a<3&&(0,r.jsx)("div",{className:"w-8 h-0.5 ".concat(["upload","produtos","pagamento","confirmar"].indexOf(ei)>a?"bg-green-500":"bg-dark-700")})]},e))}),"upload"===ei&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("input",{ref:e6,type:"file",accept:".xml",onChange:ar,className:"hidden"}),(0,r.jsxs)("div",{onClick:()=>{var e;return null===(e=e6.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed border-dark-600 rounded-xl p-12 cursor-pointer hover:border-primary-500 transition-colors",children:[(0,r.jsx)(o.Z,{className:"w-12 h-12 text-dark-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-white font-medium mb-2",children:"Clique para selecionar o arquivo XML"}),(0,r.jsx)("p",{className:"text-dark-400 text-sm",children:"ou arraste e solte aqui"})]})]}),"produtos"===ei&&en&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"glass-card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,r.jsx)(i.Z,{className:"w-5 h-5 text-primary-400"}),(0,r.jsx)("span",{className:"font-medium text-white",children:"Dados do Fornecedor"}),ed?(0,r.jsx)(y.Ct,{variant:"success",children:"Cadastrado"}):(0,r.jsx)(y.Ct,{variant:"warning",children:"Ser\xe1 cadastrado"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400",children:"Raz\xe3o Social"}),(0,r.jsx)("p",{className:"text-white",children:en.fornecedor.razaoSocial})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400",children:"CNPJ"}),(0,r.jsx)("p",{className:"text-white",children:en.fornecedor.cnpj})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400",children:"Cidade/UF"}),(0,r.jsxs)("p",{className:"text-white",children:[en.fornecedor.cidade,"/",en.fornecedor.estado]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400",children:"Telefone"}),(0,r.jsx)("p",{className:"text-white",children:en.fornecedor.telefone||"-"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("span",{className:"font-medium text-white",children:["Produtos (",en.produtos.length,")"]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:ek,onChange:e=>e_(e.target.checked),className:"w-4 h-4 rounded border-dark-500 bg-dark-700 text-primary-500 focus:ring-primary-500"}),(0,r.jsx)("span",{className:"text-sm text-dark-300",children:"Atualizar pre\xe7o de venda automaticamente"})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex gap-4 text-xs",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-green-400",children:["Existente (",Array.from(eA.values()).filter(e=>e.existente).length,")"]})]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-yellow-400",children:["Novo (",Array.from(eA.values()).filter(e=>!e.existente).length,")"]})]})]}),eV&&(0,r.jsxs)("span",{className:"text-xs text-dark-400 flex items-center gap-2",children:[(0,r.jsx)(y.TK,{size:"sm"})," Verificando produtos..."]})]}),(0,r.jsx)("div",{className:"space-y-2",children:en.produtos.map((e,a)=>{var s,o;let n=eA.get(a),l=null==n?void 0:n.existente,i=null==n?void 0:n.produtoDb,c=eJ[a]||"auto",u=eR[a]?t.find(e=>e.id===eR[a]):null,m="ignorar"===c?"border-l-dark-500 opacity-50":"vincular"===c&&u?"border-l-blue-500":l?"border-l-green-500":"border-l-yellow-500";return(0,r.jsxs)("div",{className:"glass-card p-3 border-l-4 ".concat(m," ").concat(eY===a?"relative z-[60]":"relative z-0"),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsxs)("span",{className:"text-xs text-dark-400",children:["#",e.codigo]}),(0,r.jsx)("span",{className:"font-medium text-white text-sm",children:e.descricao})]}),e.gtin&&e.gtin.length>3&&!/^0+$/.test(e.gtin)&&(0,r.jsxs)("div",{className:"text-xs text-dark-500 mb-1",children:["EAN: ",e.gtin]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-dark-400 mb-2",children:[(0,r.jsxs)("span",{children:["NCM: ",e.ncm]}),(0,r.jsxs)("span",{className:"text-primary-400 font-medium",children:["Qtd: ",e.quantidade," ",e.unidade]}),(0,r.jsxs)("span",{children:["Custo NF: ",(0,k.xG)(e.valorUnitario)]}),(0,r.jsxs)("span",{className:"text-primary-400 font-medium",children:["Total: ",(0,k.xG)(e.valorTotal)]})]}),"auto"===c&&l&&i&&(0,r.jsxs)("div",{className:"bg-green-500/10 rounded p-2 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-400 font-medium mb-1",children:[(0,r.jsx)(p.Z,{className:"w-3 h-3"}),"Produto encontrado no sistema"]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 text-dark-300",children:[(0,r.jsxs)("span",{children:["Estoque atual: ",(0,r.jsxs)("span",{className:"text-white font-medium",children:[i.quantidade_estoque," ",i.unidade]})]}),(0,r.jsxs)("span",{children:["Custo atual: ",(0,r.jsx)("span",{className:"text-white",children:(0,k.xG)(i.valor_custo)})]}),(0,r.jsxs)("span",{children:["Venda atual: ",(0,r.jsx)("span",{className:"text-white",children:(0,k.xG)(i.valor_venda)})]}),(0,r.jsxs)("span",{children:["Margem: ",(0,r.jsxs)("span",{className:"text-white",children:[(null===(s=i.margem_lucro)||void 0===s?void 0:s.toFixed(1))||0,"%"]})]})]}),ek&&i.margem_lucro&&i.margem_lucro>0&&(0,r.jsxs)("div",{className:"mt-1 text-dark-400",children:["→ Novo pre\xe7o venda: ",(0,r.jsx)("span",{className:"text-primary-400 font-medium",children:(0,k.xG)(e.valorUnitario*(1+(i.margem_lucro||0)/100))}),(0,r.jsxs)("span",{className:"text-dark-500",children:[" (mant\xe9m margem de ",null===(o=i.margem_lucro)||void 0===o?void 0:o.toFixed(0),"%)"]})]})]}),"auto"===c&&!l&&!eV&&(0,r.jsx)("div",{className:"bg-yellow-500/10 rounded p-2 text-xs",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-yellow-400 font-medium",children:[(0,r.jsx)(v.Z,{className:"w-3 h-3"}),"Produto ser\xe1 cadastrado automaticamente"]})}),"vincular"===c&&u&&(0,r.jsxs)("div",{className:"bg-blue-500/10 rounded p-2 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-blue-400 font-medium mb-1",children:[(0,r.jsx)(p.Z,{className:"w-3 h-3"}),"Vinculado a: ",u.nome]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 text-dark-300",children:[(0,r.jsxs)("span",{children:["Estoque atual: ",(0,r.jsxs)("span",{className:"text-white font-medium",children:[u.quantidade_estoque," ",u.unidade]})]}),(0,r.jsxs)("span",{children:["Custo atual: ",(0,r.jsx)("span",{className:"text-white",children:(0,k.xG)(u.valor_custo)})]})]})]})]}),(0,r.jsx)("div",{className:"flex flex-col items-end gap-2 min-w-[180px]",children:(0,r.jsx)("select",{value:c,onChange:e=>{let t=e.target.value;eX(e=>({...e,[a]:t})),"vincular"!==t&&eQ(e=>{let t={...e};return delete t[a],t})},className:"input text-xs w-full",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("option",{value:"auto",children:"Atualizar estoque"}),(0,r.jsx)("option",{value:"vincular",children:"Vincular a outro produto"}),(0,r.jsx)("option",{value:"cadastrar",children:"Cadastrar como novo"}),(0,r.jsx)("option",{value:"ignorar",children:"Ignorar"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("option",{value:"auto",children:"Cadastrar novo produto"}),(0,r.jsx)("option",{value:"vincular",children:"Vincular a existente"}),(0,r.jsx)("option",{value:"ignorar",children:"Ignorar"})]})})})]}),"vincular"===c&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-dark-600",children:[(0,r.jsx)("label",{className:"text-dark-300 text-xs block mb-2",children:"Pesquise e selecione o produto existente para vincular:"}),(0,r.jsx)("div",{className:"relative",ref:e=>{eW.current[a]=e},children:eR[a]?(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("div",{className:"input w-full text-sm flex items-center justify-between",children:[(0,r.jsx)("span",{className:"truncate",children:(()=>{let e=t.find(e=>e.id===eR[a]);return e?"".concat(e.codigo?"[".concat(e.codigo,"] "):"").concat(e.nome," - Estoque: ").concat(e.quantidade_estoque," ").concat(e.unidade):""})()}),(0,r.jsx)("button",{type:"button",onClick:()=>{eQ(e=>{let t={...e};return delete t[a],t}),eB(e=>({...e,[a]:""})),eK(a)},className:"text-dark-400 hover:text-red-400 ml-2 flex-shrink-0",title:"Remover v\xednculo",children:(0,r.jsx)(h.Z,{className:"w-3.5 h-3.5"})})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(d.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-400"}),(0,r.jsx)("input",{type:"text",value:eH[a]||"",onChange:e=>{eB(t=>({...t,[a]:e.target.value})),eK(a)},onFocus:()=>eK(a),placeholder:"Digite para buscar produto...",className:"input w-full text-sm pl-9",autoComplete:"off"})]}),eY===a&&(0,r.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-dark-700 border border-dark-500 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:(()=>{let e=(eH[a]||"").toLowerCase().trim(),s=t.filter(e=>!1!==e.ativo).filter(a=>{var t;if(!e)return!0;let r=a.nome.toLowerCase().includes(e),s=null===(t=a.codigo)||void 0===t?void 0:t.toLowerCase().includes(e);return r||s}).sort((e,a)=>e.nome.localeCompare(a.nome));return 0===s.length?(0,r.jsx)("div",{className:"px-3 py-4 text-dark-400 text-sm text-center",children:"Nenhum produto encontrado"}):s.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>{eQ(t=>({...t,[a]:e.id})),eK(null),eB(e=>({...e,[a]:""}))},className:"w-full text-left px-3 py-2.5 text-sm hover:bg-dark-600 transition-colors border-b border-dark-600 last:border-0 flex flex-col gap-0.5",children:[(0,r.jsxs)("span",{className:"text-white font-medium truncate",children:[e.codigo?"[".concat(e.codigo,"] "):"",e.nome]}),(0,r.jsxs)("span",{className:"text-dark-300 text-xs",children:["Estoque: ",e.quantidade_estoque," ",e.unidade," | Custo: ",(0,k.xG)(e.valor_custo)]})]},e.id))})()})]})}),!eR[a]&&(0,r.jsx)("p",{className:"text-yellow-400 text-xs mt-1",children:"⚠️ Selecione um produto para continuar"}),eR[a]&&(0,r.jsx)("p",{className:"text-green-400 text-xs mt-1",children:"✓ O estoque deste produto ser\xe1 atualizado com a entrada da NF"})]})]},a)})})]}),(0,r.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,r.jsx)(N.z,{variant:"secondary",onClick:()=>ec("upload"),children:"Voltar"}),(0,r.jsx)(N.z,{onClick:()=>{if(en){for(let e=0;e<en.produtos.length;e++)if("vincular"===eJ[e]&&!eR[e]){alert('Selecione um produto para vincular ao item "'.concat(en.produtos[e].descricao,'" ou escolha outra op\xe7\xe3o.'));return}}ec("pagamento")},disabled:eV,children:"Pr\xf3ximo"})]})]}),"pagamento"===ei&&en&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"glass-card p-4",children:[(0,r.jsx)("p",{className:"text-dark-400 text-sm",children:"Valor Total da Nota"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-white",children:(0,k.xG)(en.valorTotal)})]}),(0,r.jsxs)("div",{className:"glass-card p-4",children:[(0,r.jsx)("p",{className:"text-dark-400 text-sm",children:"Valor do Frete"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-white",children:(0,k.xG)(en.valorFrete)})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:ej,onChange:e=>eN(e.target.checked),className:"w-5 h-5 rounded text-primary-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-white font-medium",children:"Lan\xe7ar no estoque"}),(0,r.jsx)("p",{className:"text-sm text-dark-400",children:"Atualizar quantidade dos produtos"})]})]}),(0,r.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:em,onChange:e=>ex(e.target.checked),className:"w-5 h-5 rounded text-primary-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-white font-medium",children:"Lan\xe7ar no caixa"}),(0,r.jsx)("p",{className:"text-sm text-dark-400",children:"Registrar como despesa paga"})]})]}),em&&(0,r.jsxs)("div",{className:"ml-8 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-dark-300 mb-2",children:"Forma de Pagamento"}),(0,r.jsx)("select",{value:eh,onChange:e=>ep(e.target.value),className:"input w-full",children:C.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm text-dark-300 mb-2",children:["Categoria da Despesa ",(0,r.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("select",{value:ev||"",onChange:e=>ef(Number(e.target.value)||null),className:"input flex-1 ".concat(!ev&&em?"border-red-500/50":""),children:[(0,r.jsx)("option",{value:"",children:"Selecione uma categoria..."}),z.map(e=>(0,r.jsx)("option",{value:e.id,children:e.nome},e.id))]}),(0,r.jsx)("button",{type:"button",onClick:()=>eS(!0),className:"p-2.5 bg-dark-700 hover:bg-dark-600 text-dark-300 hover:text-primary-400 rounded-lg transition-colors",title:"Criar nova categoria",children:(0,r.jsx)(f.Z,{className:"w-5 h-5"})})]}),!ev&&em&&(0,r.jsx)("p",{className:"text-xs text-red-400 mt-1",children:"Selecione uma categoria para continuar"})]})]}),(0,r.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:eg,onChange:e=>ey(e.target.checked),className:"w-5 h-5 rounded text-primary-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-white font-medium",children:"Gerar conta a pagar"}),(0,r.jsx)("p",{className:"text-sm text-dark-400",children:"Para pagamento futuro (boleto)"})]})]}),eg&&(0,r.jsxs)("div",{className:"ml-8",children:[(0,r.jsx)("label",{className:"block text-sm text-dark-300 mb-2",children:"Data de Vencimento"}),(0,r.jsx)("input",{type:"date",value:ew,onChange:e=>eb(e.target.value),className:"input w-full"})]})]}),(0,r.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,r.jsx)(N.z,{variant:"secondary",onClick:()=>ec("produtos"),children:"Voltar"}),(0,r.jsx)(N.z,{onClick:()=>{if(em&&!ev){alert("Selecione uma categoria de despesa para lan\xe7ar no caixa.");return}ec("confirmar")},children:"Pr\xf3ximo"})]})]}),"confirmar"===ei&&en&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"glass-card p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-white mb-4",children:"Resumo da Importa\xe7\xe3o"}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-dark-400",children:"Nota Fiscal"}),(0,r.jsxs)("span",{className:"text-white",children:[en.numero," / S\xe9rie ",en.serie]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-dark-400",children:"Fornecedor"}),(0,r.jsx)("span",{className:"text-white",children:en.fornecedor.razaoSocial})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-dark-400",children:"Valor Total"}),(0,r.jsx)("span",{className:"text-white font-medium",children:(0,k.xG)(en.valorTotal)})]}),(0,r.jsxs)("div",{className:"border-t border-dark-700 pt-3 mt-3",children:[(0,r.jsx)("p",{className:"text-dark-400 mb-2",children:"Produtos:"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("p",{className:"text-primary-400",children:[en.produtos.length," itens ser\xe3o processados automaticamente"]}),(0,r.jsx)("p",{className:"text-xs text-dark-400",children:"(Existentes ser\xe3o atualizados, novos ser\xe3o criados)"})]})]}),(0,r.jsxs)("div",{className:"border-t border-dark-700 pt-3 mt-3",children:[(0,r.jsx)("p",{className:"text-dark-400 mb-2",children:"A\xe7\xf5es:"}),(0,r.jsxs)("div",{className:"space-y-1",children:[ej&&(0,r.jsx)("p",{className:"text-white",children:"✓ Lan\xe7ar no estoque"}),em&&(0,r.jsxs)("p",{className:"text-white",children:["✓ Lan\xe7ar no caixa (",eh,")"]}),eg&&(0,r.jsx)("p",{className:"text-white",children:"✓ Gerar conta a pagar"}),!ed&&(0,r.jsx)("p",{className:"text-white",children:"✓ Cadastrar fornecedor"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,r.jsx)(N.z,{variant:"secondary",onClick:()=>ec("pagamento"),children:"Voltar"}),(0,r.jsx)(N.z,{onClick:as,disabled:I,children:I?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Processando..."]}):"Confirmar Importa\xe7\xe3o"})]})]})]})}),(0,r.jsx)(g.u,{isOpen:H,onClose:()=>{B(!1),K(null),ea(null)},title:"Excluir Nota Fiscal de Entrada",size:"md",children:(0,r.jsxs)("div",{className:"space-y-4",children:[ee?(0,r.jsx)("div",{className:"p-4 rounded-lg border ".concat(ee.success?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"),children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[ee.success?(0,r.jsx)(p.Z,{className:"w-5 h-5 text-green-400 mt-0.5"}):(0,r.jsx)(v.Z,{className:"w-5 h-5 text-red-400 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium ".concat(ee.success?"text-green-400":"text-red-400"),children:ee.success?"Exclus\xe3o realizada":"Erro na exclus\xe3o"}),(0,r.jsx)("p",{className:"text-dark-300 text-sm mt-1",children:ee.message})]})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(v.Z,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-yellow-400 font-medium",children:"Aten\xe7\xe3o - Exclus\xe3o em Cascata"}),(0,r.jsx)("p",{className:"text-dark-300 text-sm mt-1",children:"Ao excluir esta nota fiscal, os seguintes registros tamb\xe9m ser\xe3o removidos:"}),(0,r.jsxs)("ul",{className:"text-dark-400 text-sm mt-2 list-disc list-inside space-y-1",children:[(0,r.jsx)("li",{children:"Movimenta\xe7\xf5es de estoque vinculadas (quantidade ser\xe1 estornada)"}),(0,r.jsx)("li",{children:"Lan\xe7amentos financeiros vinculados"}),(0,r.jsx)("li",{children:"Contas a pagar vinculadas"}),(0,r.jsx)("li",{children:"Itens da nota fiscal"})]}),(0,r.jsx)("p",{className:"text-dark-300 text-sm mt-3 font-medium",children:"Esta a\xe7\xe3o n\xe3o pode ser desfeita."})]})]})}),Y&&(0,r.jsx)("div",{className:"p-3 bg-dark-700 rounded-lg",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-white font-medium",children:["NF ",Y.numero]}),(0,r.jsx)("p",{className:"text-dark-400 text-sm",children:Y.fornecedor_razao_social})]}),(0,r.jsx)("p",{className:"text-lg font-bold text-white",children:(0,k.xG)(Y.valor_total)})]})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,r.jsx)(N.z,{variant:"secondary",onClick:()=>{B(!1),K(null),ea(null)},children:(null==ee?void 0:ee.success)?"Fechar":"Cancelar"}),!ee&&(0,r.jsx)(N.z,{variant:"danger",onClick:e9,isLoading:W,children:"Confirmar Exclus\xe3o"})]})]})}),(0,r.jsx)(w.i,{isOpen:A,onClose:()=>G(!1),fornecedorId:J}),(0,r.jsx)(w.rT,{isOpen:V,onClose:()=>U(!1),produtoId:R}),(0,r.jsx)(g.u,{isOpen:eC,onClose:()=>{eS(!1),eq("")},title:"Nova Categoria de Despesa",size:"sm",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Nome da Categoria *"}),(0,r.jsx)("input",{type:"text",value:eE,onChange:e=>eq(e.target.value),placeholder:"Ex: Despesa de Material",className:"input w-full",autoFocus:!0})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-dark-700",children:[(0,r.jsx)(N.z,{variant:"secondary",onClick:()=>{eS(!1),eq("")},children:"Cancelar"}),(0,r.jsx)(N.z,{onClick:async()=>{if(!eE.trim()){alert("Nome \xe9 obrigat\xf3rio");return}eF(!0);try{let e=await (0,b.ZF)({nome:eE.trim(),tipo:"despesa",ativo:!0}),a=await (0,b.SJ)("despesa");F(a),ef(e.id),eS(!1),eq("")}catch(e){console.error("Erro ao criar categoria:",e),alert("Erro ao criar categoria: "+(e instanceof Error?e.message:"Erro desconhecido"))}finally{eF(!1)}},disabled:ez,children:ez?"Criando...":"Criar e Selecionar"})]})]})}),(0,r.jsx)(g.u,{isOpen:eI,onClose:()=>{eT(!1),eM([]),eO(null)},title:"Lan\xe7amentos OFX Encontrados",size:"lg",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(v.Z,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-yellow-500 font-medium mb-1",children:"Poss\xedveis Duplicados"}),(0,r.jsx)("p",{className:"text-dark-300 text-sm",children:"Encontramos lan\xe7amentos no caixa que podem ser o mesmo evento desta NF. Selecione um para reconciliar (atualizar) ou crie um novo lan\xe7amento."})]})]})}),eD&&(0,r.jsxs)("div",{className:"bg-dark-700 rounded-lg p-4",children:[(0,r.jsx)("h5",{className:"text-dark-300 text-sm mb-2",children:"Dados da NF a importar:"}),(0,r.jsxs)("p",{className:"text-white font-medium",children:["NF ",eD.numero," - ",eD.fornecedorNome]}),(0,r.jsx)("p",{className:"text-primary-400 font-bold",children:(0,k.xG)((null==en?void 0:en.valorTotal)||0)})]}),(0,r.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:eZ.map(e=>(0,r.jsx)("div",{className:"p-4 rounded-lg border-2 cursor-pointer transition-all ".concat(eL===e.id?"bg-primary-500/20 border-primary-500":"bg-dark-700 border-dark-600 hover:border-dark-500"),onClick:()=>eP(e.id),children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("span",{className:"text-white font-medium",children:(0,k.xG)(e.valor)}),(0,r.jsx)("span",{className:"text-dark-400",children:"•"}),(0,r.jsx)("span",{className:"text-dark-300 text-sm",children:(0,k.p6)(e.data_lancamento)}),e.ofx_fitid&&(0,r.jsx)(y.Ct,{variant:"secondary",size:"sm",children:"OFX"})]}),(0,r.jsx)("p",{className:"text-dark-300 text-sm truncate",children:e.descricao}),(0,r.jsxs)("p",{className:"text-dark-500 text-xs mt-1",children:["Similaridade: ",Math.round(100*e.score),"% | Diferen\xe7a: ",e.diferencaDias," dia(s)"]})]}),(0,r.jsx)("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center ".concat(eL===e.id?"border-primary-500 bg-primary-500":"border-dark-500"),children:eL===e.id&&(0,r.jsx)(p.Z,{className:"w-4 h-4 text-white"})})]})},e.id))}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4 border-t border-dark-700",children:[(0,r.jsx)(N.z,{variant:"secondary",className:"flex-1",onClick:()=>ao(null),disabled:I,children:"Criar Novo Lan\xe7amento"}),(0,r.jsx)(N.z,{className:"flex-1",onClick:()=>{eL&&ao(eL)},disabled:!eL||I,children:I?"Processando...":"Reconciliar Selecionado"})]})]})}),(0,r.jsx)(g.u,{isOpen:e$,onClose:ai,title:"Produtos da NF ".concat((null==e4?void 0:e4.numero)||""),size:"lg",children:(0,r.jsxs)("div",{className:"space-y-4",children:[e4&&(0,r.jsx)("div",{className:"glass-card p-4 mb-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400",children:"Fornecedor"}),(0,r.jsx)("p",{className:"text-white font-medium",children:e4.fornecedor_razao_social})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400",children:"Data Entrada"}),(0,r.jsx)("p",{className:"text-white",children:(0,k.p6)(e4.data_entrada)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400",children:"Valor Total"}),(0,r.jsx)("p",{className:"text-white font-medium",children:(0,k.xG)(e4.valor_total)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-dark-400",children:"Qtd Produtos"}),(0,r.jsxs)("p",{className:"text-white font-medium",children:[e1.length," itens"]})]})]})}),e3?(0,r.jsx)("div",{className:"flex justify-center py-8",children:(0,r.jsx)(y.TK,{size:"lg"})}):0===e1.length?(0,r.jsx)("div",{className:"text-center py-8 text-dark-400",children:"Nenhum produto encontrado nesta nota"}):(0,r.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e1.map((e,a)=>(0,r.jsx)("div",{className:"glass-card p-3 hover:bg-dark-700/50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsxs)("span",{className:"text-xs text-dark-400",children:["#",e.codigo_produto_nf]}),(0,r.jsx)("span",{className:"font-medium text-white text-sm",children:e.descricao}),"cadastrado"===e.acao&&(0,r.jsx)(y.Ct,{variant:"warning",className:"text-xs",children:"Novo"})]}),e.produto&&(0,r.jsxs)("button",{onClick:()=>{Q(e.produto_id),U(!0)},className:"text-xs text-primary-400 hover:text-primary-300 transition-colors mb-1 block",children:["→ ",e.produto.nome," (C\xf3d: ",e.produto.codigo||"N/A",")"]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-dark-400",children:[(0,r.jsxs)("span",{children:["NCM: ",e.ncm||"-"]}),(0,r.jsxs)("span",{children:["CFOP: ",e.cfop||"-"]}),(0,r.jsxs)("span",{className:"text-primary-400 font-medium",children:["Qtd: ",e.quantidade," ",e.unidade]}),(0,r.jsxs)("span",{children:["Custo Unit: ",(0,k.xG)(e.valor_unitario)]})]})]}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsx)("p",{className:"text-lg font-bold text-primary-400",children:(0,k.xG)(e.valor_total)})})]})},e.id||a))}),e1.length>0&&(0,r.jsx)("div",{className:"border-t border-dark-700 pt-4 mt-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-dark-400",children:"Total dos Produtos:"}),(0,r.jsx)("span",{className:"text-xl font-bold text-white",children:(0,k.xG)(e1.reduce((e,a)=>e+(a.valor_total||0),0))})]})}),(0,r.jsx)("div",{className:"flex justify-end pt-4",children:(0,r.jsx)(N.z,{variant:"secondary",onClick:ai,children:"Fechar"})})]})})]})}},14958:function(e,a,t){"use strict";t.d(a,{AE:function(){return h},AT:function(){return w},FZ:function(){return g},GL:function(){return l},Gx:function(){return u},JA:function(){return n},Kx:function(){return N},OQ:function(){return r},Qf:function(){return f},S3:function(){return b},SE:function(){return i},SL:function(){return s},VR:function(){return d},gQ:function(){return v},hM:function(){return c},mU:function(){return y},nx:function(){return o},r0:function(){return m},uY:function(){return x},y5:function(){return p},zM:function(){return j}});let r=(0,t(69073).eI)("https://yhiiupamxdjmnrktkjku.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloaWl1cGFteGRqbW5ya3Rramt1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0ODg2NzUsImV4cCI6MjA4NDA2NDY3NX0._QjYtYAlypJdursHe0-rPz14QOT4NNP2EklqcJ6TpkI");async function s(){let{data:e,error:a}=await r.from("orcamentos").select("*").order("data",{ascending:!1});if(a)throw console.error("Erro ao buscar or\xe7amentos:",a),a;return e||[]}async function o(e){let{data:a,error:t}=await r.from("orcamentos").insert([e]).select().single();if(t)throw console.error("Erro ao criar or\xe7amento:",t),Error(t.message);return a}async function n(e,a){let{data:t,error:s}=await r.from("orcamentos").update(a).eq("id",e).select().single();if(s)throw console.error("Erro ao atualizar or\xe7amento:",s),Error(s.message);return t}async function l(e){let{error:a}=await r.from("orcamentos").delete().eq("id",e);if(a)throw console.error("Erro ao excluir or\xe7amento:",a),Error(a.message)}async function i(){let{data:e,error:a}=await r.from("materiais").select("*").order("nome",{ascending:!0});if(a)throw console.error("Erro ao buscar materiais:",a),a;return e||[]}async function c(e){let{data:a,error:t}=await r.from("materiais").insert([e]).select().single();if(t)throw console.error("Erro ao criar material:",t),Error(t.message);return a}async function d(e,a){let{data:t,error:s}=await r.from("materiais").update(a).eq("id",e).select().single();if(s)throw console.error("Erro ao atualizar material:",s),Error(s.message);return t}async function u(e){let{error:a}=await r.from("materiais").delete().eq("id",e);if(a)throw console.error("Erro ao excluir material:",a),Error(a.message)}async function m(){let{data:e,error:a}=await r.from("obras").select("\n      *,\n      orcamento:orcamentos(id, cliente, status)\n    ").order("created_at",{ascending:!1});if(a)throw console.error("Erro ao buscar obras:",a),a;return e||[]}async function x(){let{data:e,error:a}=await r.from("obras").select("\n      *,\n      orcamento:orcamentos(id, cliente)\n    ").eq("status","em_andamento").order("created_at",{ascending:!1});if(a)throw console.error("Erro ao buscar obras em andamento:",a),a;return e||[]}async function h(e){let{data:a,error:t}=await r.from("obras").insert([e]).select().single();if(t)throw console.error("Erro ao criar obra:",t),Error(t.message);return a}async function p(e,a){let{data:t,error:s}=await r.from("obras").update(a).eq("id",e).select().single();if(s)throw console.error("Erro ao atualizar obra:",s),Error(s.message);return t}async function v(e){let{error:a}=await r.from("obras").delete().eq("id",e);if(a)throw console.error("Erro ao excluir obra:",a),Error(a.message)}async function f(e){let{data:a,error:t}=await r.from("obra_materiais").select("\n      *,\n      material:materiais(id, nome)\n    ").eq("obra_id",e);if(t)throw console.error("Erro ao buscar materiais da obra:",t),t;return a||[]}async function j(e){let{data:a}=await r.from("obra_materiais").select("id").eq("obra_id",e.obra_id).eq("material_id",e.material_id).single();if(a){let{data:t,error:s}=await r.from("obra_materiais").update({quantidade:e.quantidade}).eq("id",a.id).select().single();if(s)throw Error(s.message);return t}{let{data:a,error:t}=await r.from("obra_materiais").insert([e]).select().single();if(t)throw Error(t.message);return a}}async function N(e,a){let{data:t,error:s}=await r.from("usuarios").select("*").ilike("email",e.trim()).eq("senha",a).single();return s?(console.error("Erro no login:",s),null):t}async function g(){let{data:e,error:a}=await r.from("usuarios").select("*").order("nome",{ascending:!0});if(a)throw console.error("Erro ao buscar usu\xe1rios:",a),a;return e||[]}async function y(e){let{data:a,error:t}=await r.from("usuarios").insert([e]).select().single();if(t)throw console.error("Erro ao criar usu\xe1rio:",t),Error(t.message);return a}async function w(e,a){let{data:t,error:s}=await r.from("usuarios").update(a).eq("id",e).select().single();if(s)throw console.error("Erro ao atualizar usu\xe1rio:",s),Error(s.message);return t}async function b(e){let{error:a}=await r.from("usuarios").delete().eq("id",e);if(a)throw console.error("Erro ao excluir usu\xe1rio:",a),Error(a.message)}}},function(e){e.O(0,[149,985,900,548,971,938,744],function(){return e(e.s=34648)}),_N_E=e.O()}]);