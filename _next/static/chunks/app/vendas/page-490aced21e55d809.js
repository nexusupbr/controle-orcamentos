(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[631],{98253:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},92919:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},62442:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},35817:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},99670:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},76637:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},94136:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]])},15713:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]])},92851:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]])},85790:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},49252:function(e,a,t){Promise.resolve().then(t.bind(t,6519))},6519:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return Z}});var n=t(57437),s=t(2265),r=t(9883),o=t(93505),i=t(15713),l=t(85790),c=t(92919),d=t(41827),u=t(99670),m=t(94136),x=t(45367),h=t(4322),p=t(98253),v=t(28203),f=t(62442),g=t(67972),j=t(76637),N=t(35817),b=t(82549),_=t(66651),w=t(548),y=t(70492),k=t(40971),C=t(87431),E=t(22169),z=t(14958),S=t(83779);let I=[{value:"dinheiro",label:"Dinheiro"},{value:"pix",label:"PIX"},{value:"debito",label:"Cart\xe3o D\xe9bito"},{value:"credito",label:"Cart\xe3o Cr\xe9dito"},{value:"boleto",label:"Boleto"},{value:"transferencia",label:"Transfer\xeancia"},{value:"cheque",label:"Cheque"}],q=[{value:"vista",label:"\xc0 Vista"},{value:"prazo",label:"A Prazo"},{value:"parcelado",label:"Parcelado"}];function Z(){var e,a,t;let[Z,F]=(0,s.useState)(!0),[A,D]=(0,s.useState)([]),[M,O]=(0,s.useState)([]),[T,G]=(0,s.useState)([]),[V,L]=(0,s.useState)(""),[P,J]=(0,s.useState)("todos"),[R,U]=(0,s.useState)(!1),[X,Q]=(0,s.useState)(!1),[Y,B]=(0,s.useState)(!1),[H,W]=(0,s.useState)(!1),[K,$]=(0,s.useState)(null),[ee,ea]=(0,s.useState)(null),[et,en]=(0,s.useState)(!1),[es,er]=(0,s.useState)(!1),[eo,ei]=(0,s.useState)(!1),[el,ec]=(0,s.useState)([]),[ed,eu]=(0,s.useState)(!1),[em,ex]=(0,s.useState)(!1),[eh,ep]=(0,s.useState)(null),[ev,ef]=(0,s.useState)(null),[eg,ej]=(0,s.useState)({cliente_id:null,data_venda:new Date().toISOString().split("T")[0],valor_desconto:0,valor_frete:0,forma_pagamento:"dinheiro",condicao_pagamento:"vista",parcelas:1,data_primeiro_vencimento:"",conta_bancaria_id:null,observacoes:"",itens:[]}),[eN,eb]=(0,s.useState)(""),[e_,ew]=(0,s.useState)(!1),[ey,ek]=(0,s.useState)({produto_id:0,quantidade:1,valor_unitario:0,valor_desconto:0});(0,s.useEffect)(()=>{eC()},[]);let eC=async()=>{try{F(!0);let[e,a,t,n]=await Promise.all([(0,C.Yz)(),(0,C.H3)(),(0,C.Xh)(),(0,C.i1)()]);D(e),O(a),G(t),ec(n)}catch(e){console.error("Erro ao carregar dados:",e)}finally{F(!1)}},eE=()=>{let e=new Date;e.setDate(e.getDate()+30),ej({cliente_id:null,data_venda:new Date().toISOString().split("T")[0],valor_desconto:0,valor_frete:0,forma_pagamento:"dinheiro",condicao_pagamento:"vista",parcelas:1,data_primeiro_vencimento:e.toISOString().split("T")[0],conta_bancaria_id:el.length>0?el[0].id:null,observacoes:"",itens:[]}),ek({produto_id:0,quantidade:1,valor_unitario:0,valor_desconto:0}),eb("")},ez=()=>{eE(),$(null),U(!0)},eS=e=>{$(e);let a=new Date(e.data_venda);a.setDate(a.getDate()+30),ej({cliente_id:e.cliente_id||null,data_venda:e.data_venda,valor_desconto:e.valor_desconto||0,valor_frete:e.valor_frete||0,forma_pagamento:"dinheiro",condicao_pagamento:"vista",parcelas:1,data_primeiro_vencimento:a.toISOString().split("T")[0],conta_bancaria_id:el.length>0?el[0].id:null,observacoes:e.observacoes||"",itens:(e.itens||[]).map(e=>({produto_id:e.produto_id,produto:T.find(a=>a.id===e.produto_id),descricao:e.descricao,quantidade:e.quantidade,valor_unitario:e.valor_unitario,valor_desconto:e.valor_desconto||0,valor_total:e.quantidade*e.valor_unitario-(e.valor_desconto||0),custo_unitario:e.custo_unitario||0}))}),U(!0)},eI=e=>{$(e),Q(!0)},eq=e=>{let a={produto_id:e.id,produto:e,descricao:e.nome,quantidade:ey.quantidade||1,valor_unitario:e.valor_venda||0,valor_desconto:0,valor_total:(ey.quantidade||1)*(e.valor_venda||0),custo_unitario:e.custo_medio||e.valor_custo||0};ej(e=>({...e,itens:[...e.itens,a]})),eb(""),ew(!1),ek({produto_id:0,quantidade:1,valor_unitario:0,valor_desconto:0})},eZ=e=>{ej(a=>({...a,itens:a.itens.filter((a,t)=>t!==e)}))},eF=(e,a,t)=>{ej(n=>{let s=[...n.itens];return s[e]={...s[e],[a]:t,valor_total:"quantidade"===a?t*s[e].valor_unitario-s[e].valor_desconto:"valor_unitario"===a?s[e].quantidade*t-s[e].valor_desconto:"valor_desconto"===a?s[e].quantidade*s[e].valor_unitario-t:s[e].valor_total},{...n,itens:s}})},eA=()=>{let e=eg.itens.reduce((e,a)=>e+a.valor_total,0),a=eg.itens.reduce((e,a)=>e+a.custo_unitario*a.quantidade,0),t=e-eg.valor_desconto+eg.valor_frete,n=t-a;return{subtotal:e,custoTotal:a,total:t,lucro:n,margem:t>0?n/t*100:0}},eD=async e=>{if(e.preventDefault(),0===eg.itens.length){alert("Adicione pelo menos um produto \xe0 venda");return}er(!0);try{let e;let a=eA(),t={cliente_id:eg.cliente_id,data_venda:eg.data_venda,valor_produtos:a.subtotal,valor_desconto:eg.valor_desconto,valor_frete:eg.valor_frete,valor_total:a.total,custo_total:a.custoTotal,lucro_bruto:a.lucro,margem_lucro:a.margem,observacoes:eg.observacoes,status:"concluida"},n=eg.itens.map(e=>({produto_id:e.produto_id,tipo:"produto",descricao:e.descricao,quantidade:e.quantidade,valor_unitario:e.valor_unitario,valor_desconto:e.valor_desconto,valor_total:e.quantidade*e.valor_unitario-e.valor_desconto,custo_unitario:e.custo_unitario}));if(K)await (0,C.H1)(K.id,t,n),e=K.id,await (0,C.hD)(e,eg.itens.map(e=>({produto_id:e.produto_id,quantidade:e.quantidade,descricao:e.descricao})));else if(e=(await (0,C.$n)(t,n)).id,await (0,C.hD)(e,eg.itens.map(e=>({produto_id:e.produto_id,quantidade:e.quantidade,descricao:e.descricao}))),"vista"===eg.condicao_pagamento)await (0,C.ZH)({tipo:"receita",valor:a.total,data_lancamento:eg.data_venda,descricao:"Venda #".concat(e),cliente_id:eg.cliente_id||void 0,venda_id:e,conta_id:eg.conta_bancaria_id||void 0,forma_pagamento:eg.forma_pagamento,conciliado:!1});else if("prazo"===eg.condicao_pagamento||"parcelado"===eg.condicao_pagamento){let t="parcelado"===eg.condicao_pagamento?eg.parcelas:1,n=Math.round(a.total/t*100)/100,s=a.total-n*(t-1),r=eg.data_primeiro_vencimento?new Date(eg.data_primeiro_vencimento+"T00:00:00"):(()=>{let e=new Date(eg.data_venda);return e.setMonth(e.getMonth()+1),e})();for(let a=0;a<t;a++){let o=new Date(r);o.setMonth(o.getMonth()+a);let i=a===t-1?s:n;await (0,C.te)({cliente_id:eg.cliente_id||void 0,descricao:"Venda #".concat(e," - Parcela ").concat(a+1,"/").concat(t),valor:i,data_vencimento:o.toISOString().split("T")[0],venda_id:e,conta_bancaria_id:eg.conta_bancaria_id||void 0,status:"pendente"})}}await eC(),U(!1),eE()}catch(e){console.error("Erro ao salvar venda:",e),alert("Erro ao salvar venda")}finally{er(!1)}},eM=async e=>{if(confirm("Tem certeza que deseja excluir esta venda?"))try{await (0,C._S)(e),await eC()}catch(e){console.error("Erro ao excluir:",e)}},{usuario:eO}=(0,S.a)(),eT=window.location.hostname.includes("github.io"),eG="https://yhiiupamxdjmnrktkjku.supabase.co",eV="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloaWl1cGFteGRqbW5ya3Rramt1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0ODg2NzUsImV4cCI6MjA4NDA2NDY3NX0._QjYtYAlypJdursHe0-rPz14QOT4NNP2EklqcJ6TpkI",eL=async e=>{if(e.nota_fiscal_emitida){alert("Esta venda j\xe1 possui nota fiscal emitida!");return}console.log("Estado do usu\xe1rio:",eO);let a=(null==eO?void 0:eO.id)||1;(null==eO?void 0:eO.id)||console.warn("Usu\xe1rio n\xe3o logado, usando ID padr\xe3o para teste");let t="homologacao";if(confirm("Deseja gerar a Nota Fiscal para esta venda?\n\nAmbiente: ".concat(t.toUpperCase()))){ei(!0);try{console.log("Enviando NFe:",{venda_id:e.id,ambiente:t,usuario_id:a,isGitHubPages:eT});let s={"Content-Type":"application/json","X-User-Id":String(a)};eT&&(s.Authorization="Bearer ".concat(eV));let r=await fetch(eT?"".concat(eG,"/functions/v1/nfe-emitir"):"/api/nfe/emitir",{method:"POST",headers:s,body:JSON.stringify({venda_id:e.id})}),o=await r.json();if(console.log("Resultado API:",o),!r.ok){let e=o.errors?o.errors.join("\n"):o.error||"Erro desconhecido";throw Error(e)}if(o.success){let{data:e}=o;if(o.idempotent){"autorizado"===e.status?alert("ℹ️ Esta venda j\xe1 possui nota fiscal autorizada!\n\nN\xfamero: ".concat(e.numero||"N/A","\nChave: ").concat(e.chave_nfe||"N/A")):"pendente"===e.status||"processando_autorizacao"===e.status?alert("ℹ️ Esta venda j\xe1 possui nota fiscal em processamento.\n\nRefer\xeancia: ".concat(e.referencia,"\nStatus: ").concat(e.status,"\n\nAguarde a autoriza\xe7\xe3o da SEFAZ.")):alert("ℹ️ Nota fiscal j\xe1 existe para esta venda.\n\nRefer\xeancia: ".concat(e.referencia,"\nStatus: ").concat(e.status)),await eC();return}if("autorizado"===e.status)await eC(),$(a=>a?{...a,nota_fiscal_emitida:!0,numero_nf:e.numero||"",chave_nf:e.chave_nfe||""}:null),alert("✅ Nota Fiscal autorizada com sucesso!\n\nN\xfamero: ".concat(e.numero,"\nS\xe9rie: ").concat(e.serie,"\nChave: ").concat(e.chave_nfe));else if("processando_autorizacao"===e.status||"pendente"===e.status)alert("⏳ Nota Fiscal enviada e aguardando autoriza\xe7\xe3o da SEFAZ.\n\nRefer\xeancia: ".concat(e.referencia,"\n\nAtualize a p\xe1gina em alguns segundos para verificar o status.")),await eC();else if("erro_autorizacao"===e.status){var n;let a=(null===(n=e.erros)||void 0===n?void 0:n.map(e=>"".concat(e.codigo,": ").concat(e.mensagem)).join("\n"))||e.mensagem_sefaz;throw Error("Erro na autoriza\xe7\xe3o:\n".concat(a))}else alert("ℹ️ Nota fiscal processada.\n\nRefer\xeancia: ".concat(e.referencia,"\nStatus: ").concat(e.status||"desconhecido","\n\n").concat(e.mensagem_sefaz||"")),await eC()}else throw Error(o.error||"Erro ao emitir nota fiscal")}catch(e){console.error("Erro ao gerar nota fiscal:",e),alert("❌ Erro ao gerar nota fiscal:\n\n".concat(e.message||e))}finally{ei(!1)}}},eP=async e=>{if(!e.nota_fiscal_emitida){alert("Esta venda n\xe3o possui nota fiscal emitida");return}en(!0),$(e),W(!0);try{if(eT){let{data:a,error:t}=await z.OQ.from("notas_fiscais").select("*").eq("venda_id",e.id).order("created_at",{ascending:!1}).limit(1),n=null==a?void 0:a[0];if(n&&!t){let e="https://homologacao.focusnfe.com.br",a=n.url_danfe?n.url_danfe.startsWith("http")?n.url_danfe:"".concat(e).concat(n.url_danfe):n.referencia?"".concat(e,"/v2/nfe/").concat(n.referencia,"/danfe"):null,t=n.url_xml?n.url_xml.startsWith("http")?n.url_xml:"".concat(e).concat(n.url_xml):n.referencia?"".concat(e,"/v2/nfe/").concat(n.referencia,"/xml"):null;ea({...n,url_danfe:a,url_xml:t})}else ea({numero:e.numero_nf,chave_nfe:e.chave_nf,status:"autorizada"})}else{let a=(null==eO?void 0:eO.id)||1,t=await fetch("/api/nfe/consultar?venda_id=".concat(e.id),{headers:{"X-User-Id":String(a)}}),n=await t.json();n.success?ea(n.data):ea({numero:e.numero_nf,chave_nfe:e.chave_nf,status:"autorizada"})}}catch(a){console.error("Erro ao buscar nota fiscal:",a),ea({numero:e.numero_nf,chave_nfe:e.chave_nf,status:"autorizada"})}finally{en(!1)}},eJ=async e=>{if(!e.nota_fiscal_emitida){alert("Esta venda n\xe3o possui nota fiscal emitida");return}let a=prompt("Digite a justificativa para o cancelamento (m\xednimo 15 caracteres):\n\nExemplo: Erro nos dados do cliente, produto incorreto, etc.","");if(a){if(a.length<15){alert("A justificativa deve ter no m\xednimo 15 caracteres");return}if(confirm("⚠️ ATEN\xc7\xc3O: Esta a\xe7\xe3o \xe9 irrevers\xedvel!\n\nDeseja realmente cancelar a nota fiscal?\n\nJustificativa: ".concat(a))){ei(!0);try{var t,n,s;let r=(null==eO?void 0:eO.id)||1,o={"Content-Type":"application/json","X-User-Id":String(r)};eT&&(o.Authorization="Bearer ".concat(eV));let i=await fetch(eT?"".concat(eG,"/functions/v1/nfe-cancelar"):"/api/nfe/cancelar",{method:"POST",headers:o,body:JSON.stringify({venda_id:e.id,justificativa:a})}),l=await i.json();if(l.success)alert("✅ Nota fiscal cancelada com sucesso!\n\nProtocolo: ".concat((null===(t=l.data)||void 0===t?void 0:t.protocolo)||"N/A")),await eC(),W(!1);else{let e=l.error||"Erro ao cancelar nota fiscal";throw(null===(n=l.data)||void 0===n?void 0:n.mensagem_sefaz)&&(e="".concat(l.data.mensagem_sefaz)),(null===(s=l.data)||void 0===s?void 0:s.status_sefaz)&&(e="C\xf3digo ".concat(l.data.status_sefaz,": ").concat(e)),Error(e)}}catch(e){console.error("Erro ao cancelar nota fiscal:",e),alert("❌ Erro ao cancelar nota fiscal:\n\n".concat(e.message||e))}finally{ei(!1)}}}},eR=async()=>{if(null==ee?void 0:ee.url_danfe){window.open(ee.url_danfe,"_blank");return}if(!(null==ee?void 0:ee.referencia)&&!(null==K?void 0:K.chave_nf)){alert("Chave da nota fiscal n\xe3o encontrada");return}try{let e=null==ee?void 0:ee.referencia;e&&window.open("".concat("https://homologacao.focusnfe.com.br","/v2/nfe/").concat(e,"/danfe"),"_blank")}catch(e){console.error("Erro ao baixar DANFE:",e),alert("Erro ao baixar DANFE")}},eU=async()=>{if(null==ee?void 0:ee.url_xml){window.open(ee.url_xml,"_blank");return}if(!(null==ee?void 0:ee.referencia)&&!(null==K?void 0:K.chave_nf)){alert("Chave da nota fiscal n\xe3o encontrada");return}try{let e=null==ee?void 0:ee.referencia;e&&window.open("".concat("https://homologacao.focusnfe.com.br","/v2/nfe/").concat(e,"/xml"),"_blank")}catch(e){console.error("Erro ao baixar XML:",e),alert("Erro ao baixar XML")}},eX=(e,a)=>{let t=e.cliente,n=e.itens||[],s=(0,E.p6)(e.data_venda);return'\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset="UTF-8">\n        <title>'.concat("cupom"===a?"Cupom":"nf"===a?"Nota Fiscal":"Venda"," #").concat(e.numero||e.id,"</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          body { \n            font-family: ").concat("cupom"===a?"'Courier New', monospace":"Arial, sans-serif",";\n            font-size: ").concat("cupom"===a?"12px":"14px",";\n            line-height: 1.4;\n            padding: ").concat("cupom"===a?"10px":"40px",";\n            max-width: ").concat("cupom"===a?"300px":"800px",";\n            margin: 0 auto;\n          }\n          .header { text-align: center; margin-bottom: 20px; border-bottom: ").concat("cupom"===a?"1px dashed #000":"2px solid #333","; padding-bottom: 15px; }\n          .header h1 { font-size: ").concat("cupom"===a?"16px":"24px","; margin-bottom: 5px; }\n          .header p { font-size: ").concat("cupom"===a?"10px":"12px","; color: #666; }\n          .info { margin-bottom: 15px; }\n          .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; }\n          .info-label { font-weight: bold; color: #333; }\n          table { width: 100%; border-collapse: collapse; margin: 15px 0; }\n          th, td { padding: ").concat("cupom"===a?"3px 0":"8px","; text-align: left; border-bottom: 1px solid #ddd; }\n          th { font-weight: bold; background: #f5f5f5; }\n          .text-right { text-align: right; }\n          .totais { margin-top: 15px; border-top: ").concat("cupom"===a?"1px dashed #000":"2px solid #333","; padding-top: 10px; }\n          .total-row { display: flex; justify-content: space-between; margin-bottom: 5px; }\n          .total-final { font-size: ").concat("cupom"===a?"14px":"18px",'; font-weight: bold; margin-top: 10px; }\n          .footer { margin-top: 30px; text-align: center; font-size: 10px; color: #999; border-top: 1px solid #eee; padding-top: 15px; }\n          .nf-info { background: #f9f9f9; padding: 15px; margin: 15px 0; border-radius: 4px; }\n          .chave { font-family: monospace; font-size: 10px; word-break: break-all; }\n          @media print { body { padding: 10px; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>').concat("cupom"===a?"CUPOM N\xc3O FISCAL":"nf"===a?"DANFE SIMPLIFICADO":"COMPROVANTE DE VENDA","</h1>\n          <p>Sistema de Gest\xe3o Empresarial</p>\n          ").concat("nf"===a&&e.numero_nf?'<p style="margin-top:10px"><strong>NF-e N\xba: '.concat(e.numero_nf,"</strong></p>"):"",'\n        </div>\n        \n        <div class="info">\n          <div class="info-row">\n            <span class="info-label">Venda:</span>\n            <span>#').concat(e.numero||e.id,'</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Data:</span>\n            <span>').concat(s,'</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Cliente:</span>\n            <span>').concat((null==t?void 0:t.nome)||(null==t?void 0:t.razao_social)||"Consumidor Final","</span>\n          </div>\n          ").concat((null==t?void 0:t.cpf)||(null==t?void 0:t.cnpj)?'\n          <div class="info-row">\n            <span class="info-label">CPF/CNPJ:</span>\n            <span>'.concat((null==t?void 0:t.cpf)||(null==t?void 0:t.cnpj),"</span>\n          </div>"):"","\n        </div>\n\n        ").concat("nf"===a&&e.chave_nf?'\n        <div class="nf-info">\n          <strong>Chave de Acesso:</strong>\n          <p class="chave">'.concat(e.chave_nf,"</p>\n        </div>"):"",'\n\n        <table>\n          <thead>\n            <tr>\n              <th>Produto</th>\n              <th class="text-right">Qtd</th>\n              <th class="text-right">Unit.</th>\n              <th class="text-right">Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            ').concat(n.map(e=>"\n              <tr>\n                <td>".concat(e.descricao||"Produto",'</td>\n                <td class="text-right">').concat(e.quantidade,'</td>\n                <td class="text-right">').concat((0,E.xG)(e.valor_unitario),'</td>\n                <td class="text-right">').concat((0,E.xG)(e.valor_total),"</td>\n              </tr>\n            ")).join(""),'\n          </tbody>\n        </table>\n\n        <div class="totais">\n          <div class="total-row">\n            <span>Subtotal:</span>\n            <span>').concat((0,E.xG)(e.valor_produtos||0),"</span>\n          </div>\n          ").concat((e.valor_desconto||0)>0?'\n          <div class="total-row">\n            <span>Desconto:</span>\n            <span>-'.concat((0,E.xG)(e.valor_desconto||0),"</span>\n          </div>"):"","\n          ").concat((e.valor_frete||0)>0?'\n          <div class="total-row">\n            <span>Frete:</span>\n            <span>'.concat((0,E.xG)(e.valor_frete||0),"</span>\n          </div>"):"","\n          ").concat("nf"===a&&(e.valor_impostos||0)>0?'\n          <div class="total-row">\n            <span>Impostos:</span>\n            <span>'.concat((0,E.xG)(e.valor_impostos||0),"</span>\n          </div>"):"",'\n          <div class="total-row total-final">\n            <span>TOTAL:</span>\n            <span>').concat((0,E.xG)(e.valor_total||0),'</span>\n          </div>\n        </div>\n\n        <div class="footer">\n          <p>Documento gerado em ').concat(new Date().toLocaleString("pt-BR"),"</p>\n          ").concat("cupom"===a?"<p>DOCUMENTO SEM VALOR FISCAL</p>":"","\n          ").concat("nf"===a?"<p>Consulte a autenticidade no portal da NF-e</p>":"","\n        </div>\n      </body>\n      </html>\n    ")},eQ=e=>{if(!K)return;if("nf"===e&&!K.nota_fiscal_emitida){alert("Esta venda ainda n\xe3o possui nota fiscal. Gere a NF primeiro.");return}let a=eX(K,e),t=window.open("","_blank","width=800,height=600");t&&(t.document.write(a),t.document.close(),t.focus(),setTimeout(()=>{t.print()},500)),B(!1)},eY=A.filter(e=>{var a,t,n,s,r;let o=(null===(a=e.numero)||void 0===a?void 0:a.toLowerCase().includes(V.toLowerCase()))||(null===(n=e.cliente)||void 0===n?void 0:null===(t=n.nome)||void 0===t?void 0:t.toLowerCase().includes(V.toLowerCase()))||(null===(r=e.cliente)||void 0===r?void 0:null===(s=r.razao_social)||void 0===s?void 0:s.toLowerCase().includes(V.toLowerCase())),i="todos"===P||e.status===P;return o&&i}),eB=T.filter(e=>{var a;return e.nome.toLowerCase().includes(eN.toLowerCase())||(null===(a=e.codigo)||void 0===a?void 0:a.toLowerCase().includes(eN.toLowerCase()))}),eH=eA(),eW=A.reduce((e,a)=>e+(a.valor_total||0),0),eK=A.reduce((e,a)=>e+(a.lucro_bruto||0),0),e$=A.length>0?eW/A.length:0;return Z?(0,n.jsx)("div",{className:"flex items-center justify-center h-[60vh]",children:(0,n.jsx)(w.TK,{size:"lg"})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl lg:text-3xl font-bold font-heading text-white",children:"Vendas"}),(0,n.jsx)("p",{className:"text-dark-400 mt-1",children:"Gerencie suas vendas e pedidos"})]}),(0,n.jsx)(_.z,{onClick:ez,leftIcon:(0,n.jsx)(r.Z,{className:"w-4 h-4"}),children:"Nova Venda"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsx)("div",{className:"glass-card p-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"p-2 rounded-lg bg-primary-500/20",children:(0,n.jsx)(o.Z,{className:"w-5 h-5 text-primary-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Total de Vendas"}),(0,n.jsx)("p",{className:"text-xl font-bold text-white",children:A.length})]})]})}),(0,n.jsx)("div",{className:"glass-card p-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"p-2 rounded-lg bg-green-500/20",children:(0,n.jsx)(i.Z,{className:"w-5 h-5 text-green-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Faturamento"}),(0,n.jsx)("p",{className:"text-xl font-bold text-green-400",children:(0,E.xG)(eW)})]})]})}),(0,n.jsx)("div",{className:"glass-card p-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"p-2 rounded-lg bg-blue-500/20",children:(0,n.jsx)(l.Z,{className:"w-5 h-5 text-blue-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Lucro Total"}),(0,n.jsx)("p",{className:"text-xl font-bold text-blue-400",children:(0,E.xG)(eK)})]})]})}),(0,n.jsx)("div",{className:"glass-card p-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"p-2 rounded-lg bg-purple-500/20",children:(0,n.jsx)(c.Z,{className:"w-5 h-5 text-purple-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Ticket M\xe9dio"}),(0,n.jsx)("p",{className:"text-xl font-bold text-purple-400",children:(0,E.xG)(e$)})]})]})})]}),(0,n.jsx)("div",{className:"glass-card p-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"relative md:col-span-2",children:[(0,n.jsx)(d.Z,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-400"}),(0,n.jsx)("input",{type:"text",placeholder:"Buscar por n\xfamero ou cliente...",value:V,onChange:e=>L(e.target.value),className:"input pl-12 w-full"})]}),(0,n.jsxs)("select",{value:P,onChange:e=>J(e.target.value),className:"input",children:[(0,n.jsx)("option",{value:"todos",children:"Todos os status"}),(0,n.jsx)("option",{value:"concluida",children:"Conclu\xedda"}),(0,n.jsx)("option",{value:"pendente",children:"Pendente"}),(0,n.jsx)("option",{value:"cancelada",children:"Cancelada"})]})]})}),(0,n.jsx)("div",{className:"glass-card overflow-hidden",children:eY.length>0?(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"data-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"N\xfamero"}),(0,n.jsx)("th",{children:"Data"}),(0,n.jsx)("th",{children:"Cliente"}),(0,n.jsx)("th",{className:"text-right",children:"Valor"}),(0,n.jsx)("th",{className:"text-right",children:"Lucro"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"NF"}),(0,n.jsx)("th",{className:"text-right",children:"A\xe7\xf5es"})]})}),(0,n.jsx)("tbody",{children:eY.map(e=>{var a,t;return(0,n.jsxs)("tr",{className:"group",children:[(0,n.jsxs)("td",{className:"font-medium text-white",children:["#",e.numero||e.id]}),(0,n.jsx)("td",{className:"text-dark-300",children:(0,E.p6)(e.data_venda)}),(0,n.jsx)("td",{className:"text-dark-300",children:(null===(a=e.cliente)||void 0===a?void 0:a.nome)||(null===(t=e.cliente)||void 0===t?void 0:t.razao_social)||"Cliente n\xe3o informado"}),(0,n.jsx)("td",{className:"text-right font-medium text-white",children:(0,E.xG)(e.valor_total||0)}),(0,n.jsx)("td",{className:"text-right",children:(0,n.jsx)("span",{className:(0,E.cn)("font-medium",(e.lucro_bruto||0)>=0?"text-green-400":"text-red-400"),children:(0,E.xG)(e.lucro_bruto||0)})}),(0,n.jsx)("td",{children:(0,n.jsx)(w.Ct,{variant:"concluida"===e.status?"success":"pendente"===e.status?"warning":"danger",children:"concluida"===e.status?"Conclu\xedda":"pendente"===e.status?"Pendente":"Cancelada"})}),(0,n.jsx)("td",{children:e.nota_fiscal_emitida?(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(w.Ct,{variant:"success",children:"Emitida"}),(0,n.jsx)("button",{onClick:()=>eP(e),className:"p-1 hover:bg-dark-600 rounded transition-colors",title:"Ver Nota Fiscal",children:(0,n.jsx)(u.Z,{className:"w-3 h-3 text-primary-400"})})]}):(0,n.jsx)("button",{onClick:()=>eL(e),disabled:eo,className:"text-xs px-2 py-1 bg-primary-500/20 text-primary-400 rounded hover:bg-primary-500/30 transition-colors disabled:opacity-50",title:"Gerar Nota Fiscal",children:eo?"...":"Gerar NF"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,n.jsx)("button",{onClick:()=>eI(e),className:"p-2 hover:bg-dark-600 rounded-lg transition-colors",title:"Visualizar",children:(0,n.jsx)(u.Z,{className:"w-4 h-4 text-dark-400"})}),(0,n.jsx)("button",{onClick:()=>eS(e),className:"p-2 hover:bg-dark-600 rounded-lg transition-colors",title:"Editar",children:(0,n.jsx)(m.Z,{className:"w-4 h-4 text-dark-400"})}),(0,n.jsx)("button",{onClick:()=>eM(e.id),className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",title:"Excluir",children:(0,n.jsx)(x.Z,{className:"w-4 h-4 text-red-400"})})]})})]},e.id)})})]})}):(0,n.jsx)(w.ub,{icon:(0,n.jsx)(o.Z,{className:"w-10 h-10 text-dark-500"}),title:"Nenhuma venda encontrada",description:"Comece criando sua primeira venda",action:(0,n.jsx)(_.z,{onClick:ez,leftIcon:(0,n.jsx)(r.Z,{className:"w-4 h-4"}),children:"Nova Venda"})})}),(0,n.jsx)(y.u,{isOpen:R,onClose:()=>U(!1),title:K?"Editar Venda":"Nova Venda",size:"xl",children:(0,n.jsxs)("form",{onSubmit:eD,className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Cliente"}),(0,n.jsxs)("select",{value:eg.cliente_id||"",onChange:e=>ej(a=>({...a,cliente_id:e.target.value?Number(e.target.value):null})),className:"input w-full",children:[(0,n.jsx)("option",{value:"",children:"Selecione um cliente"}),M.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.nome||e.razao_social," ",e.cpf||e.cnpj?"- ".concat(e.cpf||e.cnpj):""]},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Data da Venda"}),(0,n.jsx)("input",{type:"date",value:eg.data_venda,onChange:e=>ej(a=>({...a,data_venda:e.target.value})),className:"input w-full",required:!0})]})]}),(0,n.jsxs)("div",{className:"glass-card p-4 bg-dark-700/50",children:[(0,n.jsxs)("h3",{className:"text-white font-medium mb-4 flex items-center gap-2",children:[(0,n.jsx)(h.Z,{className:"w-5 h-5"}),"Adicionar Produto"]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"md:col-span-3 relative",children:[(0,n.jsx)("input",{type:"text",placeholder:"Buscar produto por nome ou c\xf3digo...",value:eN,onChange:e=>{eb(e.target.value),ew(!0)},onFocus:()=>ew(!0),className:"input w-full"}),e_&&eN&&(0,n.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-dark-700 border border-dark-600 rounded-lg shadow-lg max-h-60 overflow-y-auto z-50",children:eB.length>0?eB.slice(0,10).map(e=>{var a,t,s;return(0,n.jsxs)("button",{type:"button",onClick:()=>eq(e),className:"w-full px-4 py-3 text-left hover:bg-dark-600 flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-white font-medium",children:e.nome}),e.codigo&&(0,n.jsxs)("span",{className:"text-dark-400 text-sm ml-2",children:["(",e.codigo,")"]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("span",{className:"text-green-400 font-medium",children:(0,E.xG)(e.valor_venda||0)}),(0,n.jsxs)("span",{className:"text-sm block font-medium px-2 py-0.5 rounded mt-1 ".concat((null!==(a=e.quantidade_estoque)&&void 0!==a?a:0)<=0?"bg-red-500/20 text-red-400":(null!==(t=e.quantidade_estoque)&&void 0!==t?t:0)<=5?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"),children:["Estoque: ",null!==(s=e.quantidade_estoque)&&void 0!==s?s:0]})]})]},e.id)}):(0,n.jsx)("div",{className:"px-4 py-3 text-dark-400",children:"Nenhum produto encontrado"})})]}),(0,n.jsx)("div",{children:(0,n.jsx)("input",{type:"number",placeholder:"Qtd",value:ey.quantidade,onChange:e=>ek(a=>({...a,quantidade:Number(e.target.value)})),min:"1",className:"input w-full"})})]})]}),eg.itens.length>0&&(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"data-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Produto"}),(0,n.jsx)("th",{className:"text-right",children:"Qtd"}),(0,n.jsx)("th",{className:"text-right",children:"Valor Unit."}),(0,n.jsx)("th",{className:"text-right",children:"Desconto"}),(0,n.jsx)("th",{className:"text-right",children:"Total"}),(0,n.jsx)("th",{})]})}),(0,n.jsx)("tbody",{children:eg.itens.map((e,a)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"font-medium text-white",children:e.descricao}),(0,n.jsx)("td",{className:"text-right",children:(0,n.jsx)("input",{type:"number",value:e.quantidade,onChange:e=>eF(a,"quantidade",Number(e.target.value)),min:"1",className:"input w-20 text-right"})}),(0,n.jsx)("td",{className:"text-right",children:(0,n.jsx)("input",{type:"number",value:e.valor_unitario,onChange:e=>eF(a,"valor_unitario",Number(e.target.value)),min:"0",step:"0.01",className:"input w-28 text-right"})}),(0,n.jsx)("td",{className:"text-right",children:(0,n.jsx)("input",{type:"number",value:e.valor_desconto,onChange:e=>eF(a,"valor_desconto",Number(e.target.value)),min:"0",step:"0.01",className:"input w-24 text-right"})}),(0,n.jsx)("td",{className:"text-right font-medium text-green-400",children:(0,E.xG)(e.valor_total)}),(0,n.jsx)("td",{children:(0,n.jsx)("button",{type:"button",onClick:()=>eZ(a),className:"p-2 hover:bg-red-500/20 rounded-lg",children:(0,n.jsx)(x.Z,{className:"w-4 h-4 text-red-400"})})})]},a))})]})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Forma de Pagamento"}),(0,n.jsx)("select",{value:eg.forma_pagamento,onChange:e=>ej(a=>({...a,forma_pagamento:e.target.value})),className:"input w-full",children:I.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Condi\xe7\xe3o"}),(0,n.jsx)("select",{value:eg.condicao_pagamento,onChange:e=>ej(a=>({...a,condicao_pagamento:e.target.value})),className:"input w-full",children:q.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:[(0,n.jsx)(p.Z,{className:"w-4 h-4 inline mr-1"}),"Conta Banc\xe1ria"]}),(0,n.jsxs)("select",{value:eg.conta_bancaria_id||"",onChange:e=>ej(a=>({...a,conta_bancaria_id:e.target.value?Number(e.target.value):null})),className:"input w-full",children:[(0,n.jsx)("option",{value:"",children:"Selecione..."}),el.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.nome," - ",e.banco]},e.id))]})]})]}),("prazo"===eg.condicao_pagamento||"parcelado"===eg.condicao_pagamento)&&(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:[(0,n.jsx)(v.Z,{className:"w-4 h-4 inline mr-1"}),"Data 1\xba Vencimento"]}),(0,n.jsx)("input",{type:"date",value:eg.data_primeiro_vencimento,onChange:e=>ej(a=>({...a,data_primeiro_vencimento:e.target.value})),className:"input w-full"})]}),"parcelado"===eg.condicao_pagamento&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Parcelas"}),(0,n.jsx)("select",{value:eg.parcelas,onChange:e=>ej(a=>({...a,parcelas:Number(e.target.value)})),className:"input w-full",children:[2,3,4,5,6,7,8,9,10,11,12].map(e=>(0,n.jsxs)("option",{value:e,children:[e,"x"]},e))})]})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-4",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Frete"}),(0,n.jsx)("input",{type:"number",value:eg.valor_frete,onChange:e=>ej(a=>({...a,valor_frete:Number(e.target.value)})),min:"0",step:"0.01",className:"input w-full"})]})}),(0,n.jsx)("div",{className:"glass-card p-4 bg-dark-700/50",children:(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Subtotal"}),(0,n.jsx)("p",{className:"text-xl font-bold text-white",children:(0,E.xG)(eH.subtotal)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Desconto"}),(0,n.jsx)("input",{type:"number",value:eg.valor_desconto,onChange:e=>ej(a=>({...a,valor_desconto:Number(e.target.value)})),min:"0",step:"0.01",className:"input text-center mt-1"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Frete"}),(0,n.jsx)("p",{className:"text-xl font-bold text-white",children:(0,E.xG)(eg.valor_frete)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Total"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-green-400",children:(0,E.xG)(eH.total)})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-dark-400 text-sm",children:["Lucro (",eH.margem.toFixed(1),"%)"]}),(0,n.jsx)("p",{className:(0,E.cn)("text-xl font-bold",eH.lucro>=0?"text-blue-400":"text-red-400"),children:(0,E.xG)(eH.lucro)})]})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Observa\xe7\xf5es"}),(0,n.jsx)("textarea",{value:eg.observacoes,onChange:e=>ej(a=>({...a,observacoes:e.target.value})),rows:3,className:"input w-full"})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-dark-600",children:[(0,n.jsx)(_.z,{type:"button",variant:"secondary",onClick:()=>U(!1),children:"Cancelar"}),(0,n.jsx)(_.z,{type:"submit",disabled:es||0===eg.itens.length,children:es?(0,n.jsx)(w.TK,{size:"sm"}):K?"Salvar":"Finalizar Venda"})]})]})}),(0,n.jsx)(y.u,{isOpen:X,onClose:()=>Q(!1),title:"Venda #".concat((null==K?void 0:K.numero)||(null==K?void 0:K.id)),size:"lg",children:K&&(0,n.jsxs)("div",{className:"space-y-6",children:[K.nota_fiscal_emitida&&(0,n.jsx)("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(f.Z,{className:"w-5 h-5 text-green-400"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-green-400 font-medium",children:"Nota Fiscal Emitida"}),(0,n.jsxs)("p",{className:"text-dark-400 text-sm",children:["NF-e N\xba: ",K.numero_nf]}),K.chave_nf&&(0,n.jsxs)("p",{className:"text-dark-500 text-xs mt-1 font-mono break-all",children:["Chave: ",K.chave_nf]})]})]})}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Cliente"}),K.cliente_id?(0,n.jsxs)("button",{onClick:()=>{ep(K.cliente_id),eu(!0)},className:"text-primary-400 font-medium hover:text-primary-300 transition-colors text-left flex items-center gap-2",children:[(0,n.jsx)(g.Z,{className:"w-4 h-4"}),(null===(e=K.cliente)||void 0===e?void 0:e.nome)||(null===(a=K.cliente)||void 0===a?void 0:a.razao_social)||"Ver Cliente"]}):(0,n.jsx)("p",{className:"text-white font-medium",children:"N\xe3o informado"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Data"}),(0,n.jsx)("p",{className:"text-white font-medium",children:(0,E.p6)(K.data_venda)})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-white font-medium mb-3",children:"Itens"}),(0,n.jsxs)("table",{className:"data-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Produto"}),(0,n.jsx)("th",{className:"text-right",children:"Qtd"}),(0,n.jsx)("th",{className:"text-right",children:"Valor"}),(0,n.jsx)("th",{className:"text-right",children:"Total"})]})}),(0,n.jsx)("tbody",{children:(K.itens||[]).map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"text-white",children:e.descricao}),(0,n.jsx)("td",{className:"text-right text-dark-300",children:e.quantidade}),(0,n.jsx)("td",{className:"text-right text-dark-300",children:(0,E.xG)(e.valor_unitario)}),(0,n.jsx)("td",{className:"text-right text-green-400",children:(0,E.xG)(e.valor_total)})]},e.id))})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-dark-600",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Total"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-green-400",children:(0,E.xG)(K.valor_total||0)})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Custo"}),(0,n.jsx)("p",{className:"text-xl font-bold text-white",children:(0,E.xG)(K.custo_total||0)})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Lucro"}),(0,n.jsx)("p",{className:(0,E.cn)("text-xl font-bold",(K.lucro_bruto||0)>=0?"text-blue-400":"text-red-400"),children:(0,E.xG)(K.lucro_bruto||0)})]})]}),K.nota_fiscal_emitida&&K.valor_impostos>0&&(0,n.jsxs)("div",{className:"text-center text-dark-400 text-sm",children:["Impostos aproximados: ",(0,E.xG)(K.valor_impostos)]}),(0,n.jsx)("div",{className:"flex flex-wrap justify-end gap-3",children:K.nota_fiscal_emitida?(0,n.jsx)(_.z,{variant:"secondary",leftIcon:(0,n.jsx)(u.Z,{className:"w-4 h-4"}),onClick:()=>eP(K),children:"Ver NF-e"}):(0,n.jsx)(_.z,{leftIcon:(0,n.jsx)(j.Z,{className:"w-4 h-4"}),onClick:()=>eL(K),disabled:eo,children:eo?(0,n.jsx)(w.TK,{size:"sm"}):"Gerar NF"})})]})}),(0,n.jsx)(y.u,{isOpen:Y,onClose:()=>B(!1),title:"Op\xe7\xf5es de Impress\xe3o",size:"sm",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("p",{className:"text-dark-400",children:"Selecione o tipo de documento para imprimir:"}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsxs)("button",{onClick:()=>eQ("cupom"),className:"flex items-center gap-4 p-4 bg-dark-700 hover:bg-dark-600 rounded-lg transition-colors text-left",children:[(0,n.jsx)("div",{className:"p-3 bg-purple-500/20 rounded-lg",children:(0,n.jsx)(i.Z,{className:"w-6 h-6 text-purple-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-white font-medium",children:"Cupom N\xe3o Fiscal"}),(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Formato 80mm para impressora t\xe9rmica"})]})]}),(0,n.jsxs)("button",{onClick:()=>eQ("venda"),className:"flex items-center gap-4 p-4 bg-dark-700 hover:bg-dark-600 rounded-lg transition-colors text-left",children:[(0,n.jsx)("div",{className:"p-3 bg-blue-500/20 rounded-lg",children:(0,n.jsx)(j.Z,{className:"w-6 h-6 text-blue-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-white font-medium",children:"Comprovante de Venda"}),(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Formato A4 completo"})]})]}),(null==K?void 0:K.nota_fiscal_emitida)&&(0,n.jsxs)("button",{onClick:()=>eQ("nf"),className:"flex items-center gap-4 p-4 bg-dark-700 hover:bg-dark-600 rounded-lg transition-colors text-left",children:[(0,n.jsx)("div",{className:"p-3 bg-green-500/20 rounded-lg",children:(0,n.jsx)(N.Z,{className:"w-6 h-6 text-green-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-white font-medium",children:"DANFE Simplificado"}),(0,n.jsx)("p",{className:"text-dark-400 text-sm",children:"Documento Auxiliar da NF-e"})]})]})]}),(0,n.jsx)("div",{className:"flex justify-end pt-4 border-t border-dark-600",children:(0,n.jsx)(_.z,{variant:"secondary",onClick:()=>B(!1),children:"Cancelar"})})]})}),(0,n.jsx)(y.u,{isOpen:H,onClose:()=>{W(!1),ea(null)},title:"Nota Fiscal",size:"lg",children:(0,n.jsxs)("div",{className:"space-y-6",children:[et?(0,n.jsxs)("div",{className:"space-y-4 animate-pulse",children:[(0,n.jsxs)("div",{className:"bg-dark-700 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("div",{className:"h-6 w-32 bg-dark-600 rounded"}),(0,n.jsx)("div",{className:"h-6 w-20 bg-dark-600 rounded-full"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"h-4 w-12 bg-dark-600 rounded"}),(0,n.jsx)("div",{className:"h-5 w-16 bg-dark-600 rounded"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"h-4 w-12 bg-dark-600 rounded"}),(0,n.jsx)("div",{className:"h-5 w-24 bg-dark-600 rounded"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"h-4 w-16 bg-dark-600 rounded"}),(0,n.jsx)("div",{className:"h-5 w-20 bg-dark-600 rounded"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"h-4 w-12 bg-dark-600 rounded"}),(0,n.jsx)("div",{className:"h-5 w-32 bg-dark-600 rounded"})]})]})]}),(0,n.jsxs)("div",{className:"bg-dark-700 rounded-lg p-4",children:[(0,n.jsx)("div",{className:"h-4 w-24 bg-dark-600 rounded mb-2"}),(0,n.jsx)("div",{className:"h-5 w-full bg-dark-600 rounded"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsx)("div",{className:"h-12 bg-dark-600 rounded-lg"}),(0,n.jsx)("div",{className:"h-12 bg-dark-600 rounded-lg"})]})]}):ee?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-dark-700 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold text-white",children:["NF-e #",ee.numero||(null==K?void 0:K.numero_nf)||"N/A"]}),(0,n.jsx)(w.Ct,{variant:"autorizado"===ee.status||"autorizada"===ee.status?"success":"cancelado"===ee.status||"cancelada"===ee.status?"danger":"pendente"===ee.status||"processando"===ee.status?"warning":"secondary",children:"autorizado"===ee.status||"autorizada"===ee.status?"Autorizada":"cancelado"===ee.status||"cancelada"===ee.status?"Cancelada":"pendente"===ee.status||"processando"===ee.status?"Pendente":ee.status||"N/A"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400",children:"S\xe9rie"}),(0,n.jsx)("p",{className:"text-white",children:ee.serie||"1"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400",children:"Venda"}),(0,n.jsxs)("p",{className:"text-white",children:["#",(null==K?void 0:K.numero)||(null==K?void 0:K.id)]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400",children:"Valor Total"}),(0,n.jsx)("p",{className:"text-white font-medium",children:(0,E.xG)((null==K?void 0:K.valor_total)||0)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-dark-400",children:"Cliente"}),(0,n.jsx)("p",{className:"text-white",children:(null==K?void 0:null===(t=K.cliente)||void 0===t?void 0:t.nome)||"Consumidor Final"})]})]})]}),(0,n.jsxs)("div",{className:"bg-dark-700 rounded-lg p-4",children:[(0,n.jsx)("p",{className:"text-dark-400 text-sm mb-2",children:"Chave de Acesso"}),(0,n.jsx)("p",{className:"text-white font-mono text-xs break-all",children:ee.chave_acesso||ee.chave_nfe||(null==K?void 0:K.chave_nf)||"N/A"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("button",{onClick:eR,className:"flex items-center justify-center gap-2 p-3 bg-primary-500/20 hover:bg-primary-500/30 rounded-lg transition-colors text-primary-400",children:[(0,n.jsx)(j.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{children:"Baixar DANFE"})]}),(0,n.jsxs)("button",{onClick:eU,className:"flex items-center justify-center gap-2 p-3 bg-green-500/20 hover:bg-green-500/30 rounded-lg transition-colors text-green-400",children:[(0,n.jsx)(N.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{children:"Baixar XML"})]})]}),("autorizado"===ee.status||"autorizada"===ee.status)&&(0,n.jsxs)("div",{className:"pt-4 border-t border-dark-600",children:[(0,n.jsxs)("button",{onClick:()=>K&&eJ(K),disabled:eo,className:"w-full flex items-center justify-center gap-2 p-3 bg-red-500/20 hover:bg-red-500/30 rounded-lg transition-colors text-red-400 disabled:opacity-50",children:[(0,n.jsx)(b.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{children:eo?"Cancelando...":"Cancelar Nota Fiscal"})]}),(0,n.jsx)("p",{className:"text-dark-500 text-xs mt-2 text-center",children:"⚠️ O cancelamento \xe9 irrevers\xedvel e s\xf3 pode ser feito em at\xe9 24h ap\xf3s a autoriza\xe7\xe3o"})]})]}):(0,n.jsx)("div",{className:"text-center py-8 text-dark-400",children:"Nenhuma informa\xe7\xe3o dispon\xedvel"}),(0,n.jsx)("div",{className:"flex justify-end pt-4 border-t border-dark-600",children:(0,n.jsx)(_.z,{variant:"secondary",onClick:()=>{W(!1),ea(null)},children:"Fechar"})})]})}),(0,n.jsx)(k.W3,{isOpen:ed,onClose:()=>eu(!1),clienteId:eh}),(0,n.jsx)(k.rT,{isOpen:em,onClose:()=>ex(!1),produtoId:ev})]})}},83779:function(e,a,t){"use strict";t.d(a,{H:function(){return l},a:function(){return c}});var n=t(57437),s=t(2265),r=t(14958);let o=(0,s.createContext)(void 0),i={getItem:e=>{try{if(window.localStorage)return localStorage.getItem(e)}catch(e){console.warn("localStorage n\xe3o dispon\xedvel:",e)}return null},setItem:(e,a)=>{try{window.localStorage&&localStorage.setItem(e,a)}catch(e){console.warn("localStorage n\xe3o dispon\xedvel:",e)}},removeItem:e=>{try{window.localStorage&&localStorage.removeItem(e)}catch(e){console.warn("localStorage n\xe3o dispon\xedvel:",e)}}};function l(e){let{children:a}=e,[t,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=i.getItem("usuario");if(e)try{let a=JSON.parse(e);l(a),m(!0)}catch(e){i.removeItem("usuario")}d(!1)},[]);let x=async(e,a)=>{try{let t=await (0,r.Kx)(e,a);if(t)return l(t),m(!0),i.setItem("usuario",JSON.stringify(t)),!0;return!1}catch(e){return console.error("Erro no login:",e),!1}},h=!u||(null==t?void 0:t.tipo)==="admin";return(0,n.jsx)(o.Provider,{value:{usuario:t,loading:c,login:x,logout:()=>{l(null),m(!1),i.removeItem("usuario")},isAdmin:h,authEnabled:u},children:a})}function c(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}},14958:function(e,a,t){"use strict";t.d(a,{AE:function(){return h},AT:function(){return _},FZ:function(){return N},GL:function(){return i},Gx:function(){return u},JA:function(){return o},Kx:function(){return j},OQ:function(){return n},Qf:function(){return f},S3:function(){return w},SE:function(){return l},SL:function(){return s},VR:function(){return d},gQ:function(){return v},hM:function(){return c},mU:function(){return b},nx:function(){return r},r0:function(){return m},uY:function(){return x},y5:function(){return p},zM:function(){return g}});let n=(0,t(69073).eI)("https://yhiiupamxdjmnrktkjku.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloaWl1cGFteGRqbW5ya3Rramt1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0ODg2NzUsImV4cCI6MjA4NDA2NDY3NX0._QjYtYAlypJdursHe0-rPz14QOT4NNP2EklqcJ6TpkI");async function s(){let{data:e,error:a}=await n.from("orcamentos").select("*").order("data",{ascending:!1});if(a)throw console.error("Erro ao buscar or\xe7amentos:",a),a;return e||[]}async function r(e){let{data:a,error:t}=await n.from("orcamentos").insert([e]).select().single();if(t)throw console.error("Erro ao criar or\xe7amento:",t),Error(t.message);return a}async function o(e,a){let{data:t,error:s}=await n.from("orcamentos").update(a).eq("id",e).select().single();if(s)throw console.error("Erro ao atualizar or\xe7amento:",s),Error(s.message);return t}async function i(e){let{error:a}=await n.from("orcamentos").delete().eq("id",e);if(a)throw console.error("Erro ao excluir or\xe7amento:",a),Error(a.message)}async function l(){let{data:e,error:a}=await n.from("materiais").select("*").order("nome",{ascending:!0});if(a)throw console.error("Erro ao buscar materiais:",a),a;return e||[]}async function c(e){let{data:a,error:t}=await n.from("materiais").insert([e]).select().single();if(t)throw console.error("Erro ao criar material:",t),Error(t.message);return a}async function d(e,a){let{data:t,error:s}=await n.from("materiais").update(a).eq("id",e).select().single();if(s)throw console.error("Erro ao atualizar material:",s),Error(s.message);return t}async function u(e){let{error:a}=await n.from("materiais").delete().eq("id",e);if(a)throw console.error("Erro ao excluir material:",a),Error(a.message)}async function m(){let{data:e,error:a}=await n.from("obras").select("\n      *,\n      orcamento:orcamentos(id, cliente, status)\n    ").order("created_at",{ascending:!1});if(a)throw console.error("Erro ao buscar obras:",a),a;return e||[]}async function x(){let{data:e,error:a}=await n.from("obras").select("\n      *,\n      orcamento:orcamentos(id, cliente)\n    ").eq("status","em_andamento").order("created_at",{ascending:!1});if(a)throw console.error("Erro ao buscar obras em andamento:",a),a;return e||[]}async function h(e){let{data:a,error:t}=await n.from("obras").insert([e]).select().single();if(t)throw console.error("Erro ao criar obra:",t),Error(t.message);return a}async function p(e,a){let{data:t,error:s}=await n.from("obras").update(a).eq("id",e).select().single();if(s)throw console.error("Erro ao atualizar obra:",s),Error(s.message);return t}async function v(e){let{error:a}=await n.from("obras").delete().eq("id",e);if(a)throw console.error("Erro ao excluir obra:",a),Error(a.message)}async function f(e){let{data:a,error:t}=await n.from("obra_materiais").select("\n      *,\n      material:materiais(id, nome)\n    ").eq("obra_id",e);if(t)throw console.error("Erro ao buscar materiais da obra:",t),t;return a||[]}async function g(e){let{data:a}=await n.from("obra_materiais").select("id").eq("obra_id",e.obra_id).eq("material_id",e.material_id).single();if(a){let{data:t,error:s}=await n.from("obra_materiais").update({quantidade:e.quantidade}).eq("id",a.id).select().single();if(s)throw Error(s.message);return t}{let{data:a,error:t}=await n.from("obra_materiais").insert([e]).select().single();if(t)throw Error(t.message);return a}}async function j(e,a){let{data:t,error:s}=await n.from("usuarios").select("*").ilike("email",e.trim()).eq("senha",a).single();return s?(console.error("Erro no login:",s),null):t}async function N(){let{data:e,error:a}=await n.from("usuarios").select("*").order("nome",{ascending:!0});if(a)throw console.error("Erro ao buscar usu\xe1rios:",a),a;return e||[]}async function b(e){let{data:a,error:t}=await n.from("usuarios").insert([e]).select().single();if(t)throw console.error("Erro ao criar usu\xe1rio:",t),Error(t.message);return a}async function _(e,a){let{data:t,error:s}=await n.from("usuarios").update(a).eq("id",e).select().single();if(s)throw console.error("Erro ao atualizar usu\xe1rio:",s),Error(s.message);return t}async function w(e){let{error:a}=await n.from("usuarios").delete().eq("id",e);if(a)throw console.error("Erro ao excluir usu\xe1rio:",a),Error(a.message)}}},function(e){e.O(0,[149,985,900,548,971,938,744],function(){return e(e.s=49252)}),_N_E=e.O()}]);