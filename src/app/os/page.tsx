'use client'

import { useEffect, useState } from 'react'
import { 
  Plus, Edit2, Trash2, Search, FileText, Eye, Check, X, 
  Package, Wrench, DollarSign, Calendar, User, Clock, AlertTriangle,
  ChevronDown, ChevronUp, Copy, Send, CheckCircle
} from 'lucide-react'
import { Button } from '@/components/ui/Button'
import { Modal } from '@/components/ui/Modal'
import { LoadingSpinner, EmptyState, Badge } from '@/components/ui/Common'
import { formatCurrency, formatDate } from '@/lib/utils'
import {
  OrdemServico, OSServico, OSProduto, Cliente, Produto,
  fetchOrdensServico, fetchOrdemServicoById, createOrdemServico, updateOrdemServico, 
  deleteOrdemServico, updateStatusOS, getProximoNumeroOS,
  fetchClientes, fetchProdutos
} from '@/lib/database'

const statusConfig: Record<string, { label: string; color: 'warning' | 'info' | 'primary' | 'success' | 'danger' | 'secondary' }> = {
  'orcamento': { label: 'Or√ßamento', color: 'warning' },
  'aprovado': { label: 'Aprovado', color: 'info' },
  'em_execucao': { label: 'Em Execu√ß√£o', color: 'primary' },
  'concluido': { label: 'Conclu√≠do', color: 'success' },
  'cancelado': { label: 'Cancelado', color: 'danger' },
  'faturado': { label: 'Faturado', color: 'secondary' }
}

export default function OSPage() {
  const [ordensServico, setOrdensServico] = useState<OrdemServico[]>([])
  const [clientes, setClientes] = useState<Cliente[]>([])
  const [produtos, setProdutos] = useState<Produto[]>([])
  const [loading, setLoading] = useState(true)
  const [saving, setSaving] = useState(false)
  const [searchTerm, setSearchTerm] = useState('')
  const [filterStatus, setFilterStatus] = useState('todos')
  
  // Modal de cria√ß√£o/edi√ß√£o
  const [isModalOpen, setIsModalOpen] = useState(false)
  const [editingOS, setEditingOS] = useState<OrdemServico | null>(null)
  const [formError, setFormError] = useState<string | null>(null)
  
  // Form data
  const [formData, setFormData] = useState({
    cliente_id: null as number | null,
    cliente_nome: '',
    data_os: new Date().toISOString().split('T')[0],
    data_entrega: '',
    tipo_atendimento: 'Externo',
    observacoes: '',
    observacoes_internas: '',
    garantia_dias: 90,
    desconto_percentual: 0,
    desconto_valor: 0
  })
  
  // Servi√ßos e produtos do formul√°rio
  const [servicos, setServicos] = useState<OSServico[]>([])
  const [produtosOS, setProdutosOS] = useState<OSProduto[]>([])
  
  // Busca de cliente
  const [clienteSearch, setClienteSearch] = useState('')
  const [showClienteDropdown, setShowClienteDropdown] = useState(false)
  
  // Busca de produto
  const [produtoSearch, setProdutoSearch] = useState('')
  const [showProdutoDropdown, setShowProdutoDropdown] = useState(false)
  const [selectedProdutoIndex, setSelectedProdutoIndex] = useState<number | null>(null)

  useEffect(() => {
    loadData()
  }, [])

  const loadData = async () => {
    try {
      setLoading(true)
      const [osData, clientesData, produtosData] = await Promise.all([
        fetchOrdensServico(),
        fetchClientes(),
        fetchProdutos()
      ])
      setOrdensServico(osData)
      setClientes(clientesData.filter(c => c.ativo))
      setProdutos(produtosData.filter(p => p.ativo))
    } catch (err) {
      console.error('Erro ao carregar dados:', err)
    } finally {
      setLoading(false)
    }
  }

  // Filtros
  const filteredOS = ordensServico.filter(os => {
    const matchSearch = os.cliente_nome.toLowerCase().includes(searchTerm.toLowerCase()) ||
      os.numero.toString().includes(searchTerm)
    const matchStatus = filterStatus === 'todos' || os.status === filterStatus
    return matchSearch && matchStatus
  })

  // Clientes filtrados para dropdown
  const filteredClientes = clientes.filter(c => {
    const nome = c.tipo_pessoa === 'PF' ? c.nome : c.razao_social
    return nome?.toLowerCase().includes(clienteSearch.toLowerCase())
  }).slice(0, 10)

  // Produtos filtrados para dropdown
  const filteredProdutos = produtos.filter(p => 
    p.nome.toLowerCase().includes(produtoSearch.toLowerCase()) ||
    p.codigo?.toLowerCase().includes(produtoSearch.toLowerCase())
  ).slice(0, 10)

  // C√°lculos
  const calcularTotais = () => {
    const totalServicos = servicos.reduce((acc, s) => acc + (s.valor_total || 0), 0)
    const totalProdutos = produtosOS.reduce((acc, p) => acc + (p.valor_total || 0), 0)
    const subtotal = totalServicos + totalProdutos
    const desconto = formData.desconto_percentual > 0 
      ? subtotal * (formData.desconto_percentual / 100) 
      : formData.desconto_valor
    const total = subtotal - desconto
    return { totalServicos, totalProdutos, subtotal, desconto, total }
  }

  // Abrir modal para nova OS
  const openNewModal = () => {
    setEditingOS(null)
    setFormData({
      cliente_id: null,
      cliente_nome: '',
      data_os: new Date().toISOString().split('T')[0],
      data_entrega: '',
      tipo_atendimento: 'Externo',
      observacoes: '',
      observacoes_internas: '',
      garantia_dias: 90,
      desconto_percentual: 0,
      desconto_valor: 0
    })
    setServicos([{ descricao: '', quantidade: 1, valor_unitario: 0, valor_total: 0, ordem: 0 }])
    setProdutosOS([])
    setClienteSearch('')
    setFormError(null)
    setIsModalOpen(true)
  }

  // Abrir modal para editar OS
  const openEditModal = async (os: OrdemServico) => {
    try {
      const osCompleta = await fetchOrdemServicoById(os.id)
      if (!osCompleta) return

      setEditingOS(osCompleta)
      setFormData({
        cliente_id: osCompleta.cliente_id,
        cliente_nome: osCompleta.cliente_nome,
        data_os: osCompleta.data_os,
        data_entrega: osCompleta.data_entrega || '',
        tipo_atendimento: osCompleta.tipo_atendimento,
        observacoes: osCompleta.observacoes || '',
        observacoes_internas: osCompleta.observacoes_internas || '',
        garantia_dias: osCompleta.garantia_dias,
        desconto_percentual: osCompleta.desconto_percentual,
        desconto_valor: osCompleta.desconto_valor
      })
      setServicos(osCompleta.servicos || [])
      setProdutosOS(osCompleta.produtos || [])
      setClienteSearch(osCompleta.cliente_nome)
      setFormError(null)
      setIsModalOpen(true)
    } catch (err) {
      console.error('Erro ao carregar OS:', err)
    }
  }

  // Visualizar/Imprimir OS diretamente
  const handleViewPrint = async (os: OrdemServico) => {
    try {
      const osCompleta = await fetchOrdemServicoById(os.id)
      if (!osCompleta) return

      const baseUrl = window.location.origin
      const htmlContent = gerarHTMLImpressao(osCompleta, baseUrl)
      
      // Criar Blob e abrir em nova aba
      const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' })
      const url = URL.createObjectURL(blob)
      const printWindow = window.open(url, '_blank')
      
      // Limpar URL ap√≥s um tempo
      if (printWindow) {
        printWindow.onload = () => {
          setTimeout(() => URL.revokeObjectURL(url), 1000)
        }
      }
    } catch (err) {
      console.error('Erro ao carregar OS:', err)
    }
  }

  // Gerar HTML para impress√£o
  const gerarHTMLImpressao = (os: OrdemServico, baseUrl: string) => {
    // Logo em base64 para funcionar na janela de impress√£o
    const logoBase64 = 'data:image/png;base64,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'
    
    const servicosHTML = os.servicos && os.servicos.length > 0 ? `
      <div class="section">
        <div class="section-title">SERVI√áOS</div>
        <table>
          <thead>
            <tr>
              <th>SERVI√áO</th>
              <th class="text-right">HORAS/QTDE</th>
              <th class="text-right">V. UNIT.</th>
              <th class="text-right">V. TOTAL</th>
            </tr>
          </thead>
          <tbody>
            ${os.servicos.map((s, i) => `
              <tr>
                <td>${i + 1}. ${s.descricao}</td>
                <td class="text-right">${s.quantidade}</td>
                <td class="text-right">${formatCurrency(s.valor_unitario)}</td>
                <td class="text-right">${formatCurrency(s.valor_total)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    ` : ''

    const produtosHTML = os.produtos && os.produtos.length > 0 ? `
      <div class="section">
        <div class="section-title">PRODUTOS</div>
        <table>
          <thead>
            <tr>
              <th>PRODUTO</th>
              <th>UNIDADE</th>
              <th class="text-right">QTDE.</th>
              <th>NCM</th>
              <th class="text-right">V. UNIT.</th>
              <th class="text-right">V. TOTAL</th>
            </tr>
          </thead>
          <tbody>
            ${os.produtos.map((p, i) => `
              <tr>
                <td>${i + 1}. ${p.codigo ? p.codigo + ' - ' : ''}${p.descricao}</td>
                <td>(${p.unidade})</td>
                <td class="text-right">${p.quantidade}</td>
                <td>${p.ncm || ''}</td>
                <td class="text-right">${formatCurrency(p.valor_unitario)}</td>
                <td class="text-right">${formatCurrency(p.valor_total)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    ` : ''

    return `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Or√ßamento #${os.numero}</title>
        <style>
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            color: #333; 
            font-size: 12px;
            position: relative;
          }
          .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.15;
            z-index: 0;
            pointer-events: none;
          }
          .watermark img {
            width: 400px;
            height: auto;
          }
          .content {
            position: relative;
            z-index: 1;
          }
          .header { border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 20px; background: transparent; }
          .header-top { display: flex; justify-content: space-between; align-items: flex-start; }
          .empresa { line-height: 1.6; }
          .empresa-nome { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
          .os-numero { font-size: 24px; font-weight: bold; text-align: right; }
          .section { margin-bottom: 20px; background: transparent; }
          .section-title { background: rgba(224, 224, 224, 0.7); padding: 8px 12px; font-weight: bold; margin-bottom: 10px; font-size: 13px; }
          table { width: 100%; border-collapse: collapse; margin-bottom: 15px; background: transparent; }
          th, td { border: 1px solid #ccc; padding: 8px; text-align: left; font-size: 11px; background: transparent; }
          th { background: rgba(245, 245, 245, 0.7); font-weight: bold; }
          .text-right { text-align: right; }
          .totais { margin-top: 20px; }
          .totais table { width: 60%; margin-left: auto; }
          .totais td { padding: 10px; }
          .total-final { font-size: 14px; font-weight: bold; background: rgba(212, 237, 218, 0.7) !important; }
          .info-row { display: flex; gap: 30px; margin: 15px 0; }
          .info-item { }
          .info-label { font-weight: bold; }
          .observacoes { margin-top: 15px; padding: 10px; background: rgba(249, 249, 249, 0.7); border: 1px solid #ddd; border-radius: 4px; }
          .assinaturas { display: flex; justify-content: space-between; margin-top: 80px; padding-top: 20px; }
          .assinatura { text-align: center; width: 30%; }
          .assinatura-linha { border-top: 1px solid #333; padding-top: 8px; font-size: 11px; margin-top: 40px; }
          .footer-info {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-size: 10px;
            color: #666;
            line-height: 1.6;
          }
          @media print { 
            body { margin: 10px; } 
            .no-print { display: none; }
            .watermark { position: fixed; }
          }
          .print-btn { 
            position: fixed; top: 10px; right: 10px; 
            padding: 10px 20px; background: #10b981; color: white; 
            border: none; border-radius: 5px; cursor: pointer; font-size: 14px;
          }
          .print-btn:hover { background: #059669; }
        </style>
      </head>
      <body>
        <div class="watermark">
          <img src="${logoBase64}" alt="Logo">
        </div>
        
        <button class="print-btn no-print" onclick="window.print()">üñ®Ô∏è Imprimir</button>
        
        <div class="header">
          <div class="header-top">
            <div class="empresa">
              <div class="empresa-nome">IRRIGA CENTRO OESTE LTDA</div>
              <div>CNPJ: 41.852.934/0001-39</div>
              <div>Rua Rachel de Queiroz, 1335 SALA 02</div>
              <div>Aquarela das Artes - Sinop - MT CEP: 78.555-450</div>
              <div>Fone: (66) 99934-6704</div>
              <div>E-mail: irrigacentrooeste@gmail.com</div>
            </div>
            <div class="os-numero">
              OR√áAMENTO<br>#${os.numero}
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title">DADOS DO CLIENTE</div>
          <table>
            <tbody>
              <tr>
                <td style="width: 50%"><strong>Cliente:</strong> ${os.cliente_nome}</td>
                <td style="width: 25%"><strong>Atendimento:</strong> ${os.tipo_atendimento}</td>
                <td style="width: 25%"><strong>Data:</strong> ${formatDate(os.data_os)}</td>
              </tr>
            </tbody>
          </table>
        </div>

        ${servicosHTML}
        ${produtosHTML}

        <div class="totais">
          <div class="section-title">DADOS DE PAGAMENTO</div>
          <table>
            <tbody>
              <tr>
                <td>TOTAL DE HORAS/QTDE DE SERVI√áOS</td>
                <td class="text-right">${os.total_horas.toFixed(2)}</td>
                <td>VALOR TOTAL DOS SERVI√áOS</td>
                <td class="text-right">${formatCurrency(os.total_servicos)}</td>
              </tr>
              <tr>
                <td>TOTAL DE PRODUTOS</td>
                <td class="text-right">${os.total_itens}</td>
                <td>VALOR TOTAL DOS PRODUTOS</td>
                <td class="text-right">${formatCurrency(os.total_produtos)}</td>
              </tr>
              <tr class="total-final">
                <td colspan="2"></td>
                <td><strong>VALOR TOTAL</strong></td>
                <td class="text-right"><strong>${formatCurrency(os.valor_total)}</strong></td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="info-row">
          <div class="info-item"><span class="info-label">DATA:</span> ${formatDate(os.data_os)}</div>
          ${os.data_entrega ? `<div class="info-item"><span class="info-label">VALIDADE:</span> ${formatDate(os.data_entrega)}</div>` : ''}
          <div class="info-item"><span class="info-label">GARANTIA:</span> ${os.garantia_dias} dias</div>
        </div>

        ${os.observacoes ? `<div class="observacoes"><strong>Observa√ß√µes:</strong> ${os.observacoes}</div>` : ''}

        <div class="assinaturas">
          <div class="assinatura">
            <div class="assinatura-linha">Data do aceite: ___/___/______</div>
          </div>
          <div class="assinatura">
            <div class="assinatura-linha">Assinatura do Prestador</div>
          </div>
          <div class="assinatura">
            <div class="assinatura-linha">Assinatura do Cliente</div>
          </div>
        </div>
        
        <div class="footer-info">
          irrigacentrooeste@gmail.com // Instagram: IRRIGA CENTRO OESTE //<br>
          66 997118751(Julio) ou 66 999346704(Andressa-financeiro)
        </div>
      </body>
      </html>
    `
  }

  // Selecionar cliente
  const selectCliente = (cliente: Cliente) => {
    const nome = cliente.tipo_pessoa === 'PF' ? cliente.nome : cliente.razao_social
    setFormData({
      ...formData,
      cliente_id: cliente.id,
      cliente_nome: nome || ''
    })
    setClienteSearch(nome || '')
    setShowClienteDropdown(false)
  }

  // Adicionar servi√ßo
  const addServico = () => {
    setServicos([...servicos, { descricao: '', quantidade: 1, valor_unitario: 0, valor_total: 0, ordem: servicos.length }])
  }

  // Atualizar servi√ßo
  const updateServico = (index: number, field: keyof OSServico, value: string | number) => {
    const newServicos = [...servicos]
    newServicos[index] = { ...newServicos[index], [field]: value }
    // Recalcular total
    if (field === 'quantidade' || field === 'valor_unitario') {
      newServicos[index].valor_total = newServicos[index].quantidade * newServicos[index].valor_unitario
    }
    setServicos(newServicos)
  }

  // Remover servi√ßo
  const removeServico = (index: number) => {
    if (servicos.length > 1) {
      setServicos(servicos.filter((_, i) => i !== index))
    }
  }

  // Adicionar produto
  const addProduto = () => {
    setProdutosOS([...produtosOS, { 
      produto_id: null, codigo: '', descricao: '', unidade: 'UN', ncm: '',
      quantidade: 1, valor_unitario: 0, valor_total: 0, ordem: produtosOS.length 
    }])
    setSelectedProdutoIndex(produtosOS.length)
    setProdutoSearch('')
  }

  // Selecionar produto do cat√°logo
  const selectProduto = (produto: Produto) => {
    if (selectedProdutoIndex === null) return
    
    const newProdutos = [...produtosOS]
    newProdutos[selectedProdutoIndex] = {
      ...newProdutos[selectedProdutoIndex],
      produto_id: produto.id,
      codigo: produto.codigo || '',
      descricao: produto.nome,
      unidade: produto.unidade,
      ncm: produto.ncm || '',
      valor_unitario: produto.valor_venda,
      valor_total: newProdutos[selectedProdutoIndex].quantidade * produto.valor_venda
    }
    setProdutosOS(newProdutos)
    setShowProdutoDropdown(false)
    setProdutoSearch('')
    setSelectedProdutoIndex(null)
  }

  // Atualizar produto
  const updateProduto = (index: number, field: keyof OSProduto, value: string | number) => {
    const newProdutos = [...produtosOS]
    newProdutos[index] = { ...newProdutos[index], [field]: value }
    // Recalcular total
    if (field === 'quantidade' || field === 'valor_unitario') {
      newProdutos[index].valor_total = newProdutos[index].quantidade * newProdutos[index].valor_unitario
    }
    setProdutosOS(newProdutos)
  }

  // Remover produto
  const removeProduto = (index: number) => {
    setProdutosOS(produtosOS.filter((_, i) => i !== index))
  }

  // Salvar OS
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!formData.cliente_nome.trim()) {
      setFormError('Selecione um cliente')
      return
    }

    // Filtrar servi√ßos e produtos vazios
    const servicosValidos = servicos.filter(s => s.descricao.trim())
    const produtosValidos = produtosOS.filter(p => p.descricao.trim())

    if (servicosValidos.length === 0 && produtosValidos.length === 0) {
      setFormError('Adicione pelo menos um servi√ßo ou produto')
      return
    }

    setSaving(true)
    setFormError(null)

    try {
      if (editingOS) {
        await updateOrdemServico(editingOS.id, {
          cliente_id: formData.cliente_id,
          cliente_nome: formData.cliente_nome,
          data_os: formData.data_os,
          data_entrega: formData.data_entrega || null,
          tipo_atendimento: formData.tipo_atendimento,
          observacoes: formData.observacoes,
          observacoes_internas: formData.observacoes_internas,
          garantia_dias: formData.garantia_dias,
          desconto_percentual: formData.desconto_percentual,
          desconto_valor: formData.desconto_valor
        }, servicosValidos, produtosValidos)
      } else {
        await createOrdemServico({
          cliente_id: formData.cliente_id,
          cliente_nome: formData.cliente_nome,
          data_os: formData.data_os,
          data_entrega: formData.data_entrega || null,
          tipo_atendimento: formData.tipo_atendimento,
          observacoes: formData.observacoes,
          observacoes_internas: formData.observacoes_internas,
          garantia_dias: formData.garantia_dias,
          desconto_percentual: formData.desconto_percentual,
          desconto_valor: formData.desconto_valor,
          status: 'orcamento'
        }, servicosValidos, produtosValidos)
      }

      await loadData()
      setIsModalOpen(false)
    } catch (err) {
      const message = err instanceof Error ? err.message : 'Erro ao salvar'
      setFormError(message)
    } finally {
      setSaving(false)
    }
  }

  // Excluir OS
  const handleDelete = async (id: number) => {
    if (!confirm('Tem certeza que deseja excluir esta OS?')) return
    try {
      await deleteOrdemServico(id)
      await loadData()
    } catch (err) {
      console.error('Erro ao excluir:', err)
    }
  }

  // Alterar status
  const handleStatusChange = async (id: number, status: OrdemServico['status']) => {
    try {
      const result = await updateStatusOS(id, status)
      
      // Se foi criada uma venda, mostrar mensagem de sucesso
      if (result.venda_id && status === 'aprovado') {
        alert(`‚úÖ Or√ßamento aprovado!\n\nVenda #${result.venda_id} criada automaticamente.\n\nAcesse a p√°gina de Vendas para visualiz√°-la.`)
      }
      
      await loadData()
    } catch (err: any) {
      console.error('Erro ao atualizar status:', err)
      alert(`‚ùå Erro ao atualizar status:\n${err.message || 'Erro desconhecido'}`)
    }
  }

  const totais = calcularTotais()

  if (loading) return <LoadingSpinner />

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold text-white">Or√ßamentos</h1>
          <p className="text-dark-400">Gerencie or√ßamentos de servi√ßos e produtos</p>
        </div>
        <Button onClick={openNewModal} leftIcon={<Plus className="w-4 h-4" />}>
          Novo Or√ßamento
        </Button>
      </div>

      {/* KPIs */}
      <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
        <div className="card p-4">
          <p className="text-dark-400 text-sm">Total</p>
          <p className="text-2xl font-bold text-white">{ordensServico.length}</p>
        </div>
        <div className="card p-4">
          <p className="text-dark-400 text-sm">Or√ßamentos</p>
          <p className="text-2xl font-bold text-yellow-400">
            {ordensServico.filter(os => os.status === 'orcamento').length}
          </p>
        </div>
        <div className="card p-4">
          <p className="text-dark-400 text-sm">Em Execu√ß√£o</p>
          <p className="text-2xl font-bold text-blue-400">
            {ordensServico.filter(os => os.status === 'em_execucao').length}
          </p>
        </div>
        <div className="card p-4">
          <p className="text-dark-400 text-sm">Conclu√≠dos</p>
          <p className="text-2xl font-bold text-green-400">
            {ordensServico.filter(os => os.status === 'concluido').length}
          </p>
        </div>
        <div className="card p-4">
          <p className="text-dark-400 text-sm">Valor Total</p>
          <p className="text-2xl font-bold text-white">
            {formatCurrency(ordensServico.reduce((acc, os) => acc + os.valor_total, 0))}
          </p>
        </div>
      </div>

      {/* Filtros */}
      <div className="card p-4">
        <div className="flex flex-col md:flex-row gap-4">
          <div className="flex-1 relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-400" />
            <input
              type="text"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              placeholder="Buscar por cliente ou n√∫mero..."
              className="input pl-10 w-full"
            />
          </div>
          <select
            value={filterStatus}
            onChange={(e) => setFilterStatus(e.target.value)}
            className="input w-full md:w-48"
          >
            <option value="todos">Todos os Status</option>
            <option value="orcamento">Or√ßamento</option>
            <option value="aprovado">Aprovado</option>
            <option value="em_execucao">Em Execu√ß√£o</option>
            <option value="concluido">Conclu√≠do</option>
            <option value="cancelado">Cancelado</option>
            <option value="faturado">Faturado</option>
          </select>
        </div>
      </div>

      {/* Lista de OS */}
      <div className="card overflow-hidden">
        {filteredOS.length === 0 ? (
          <EmptyState
            icon={<FileText className="w-10 h-10 text-dark-500" />}
            title="Nenhum or√ßamento encontrado"
            description="Crie seu primeiro or√ßamento"
          />
        ) : (
          <div className="overflow-x-auto">
            <table className="data-table">
              <thead>
                <tr>
                  <th>N¬∫ OS</th>
                  <th>Data</th>
                  <th>Cliente</th>
                  <th>Servi√ßos</th>
                  <th>Produtos</th>
                  <th>Total</th>
                  <th>Status</th>
                  <th className="text-right">A√ß√µes</th>
                </tr>
              </thead>
              <tbody>
                {filteredOS.map((os) => (
                  <tr key={os.id}>
                    <td>
                      <span className="font-mono font-bold text-primary-400">#{os.numero}</span>
                    </td>
                    <td className="text-dark-300">{formatDate(os.data_os)}</td>
                    <td className="text-white font-medium">{os.cliente_nome}</td>
                    <td className="text-dark-300">{formatCurrency(os.total_servicos)}</td>
                    <td className="text-dark-300">{formatCurrency(os.total_produtos)}</td>
                    <td className="text-white font-bold">{formatCurrency(os.valor_total)}</td>
                    <td>
                      <Badge variant={statusConfig[os.status]?.color || 'secondary'}>
                        {statusConfig[os.status]?.label || os.status}
                      </Badge>
                    </td>
                    <td>
                      <div className="flex items-center justify-end gap-2">
                        <button
                          onClick={() => handleViewPrint(os)}
                          className="p-2 text-dark-400 hover:text-white hover:bg-dark-700 rounded-lg transition-colors"
                          title="Visualizar/Imprimir"
                        >
                          <Eye className="w-4 h-4" />
                        </button>
                        <button
                          onClick={() => openEditModal(os)}
                          className="p-2 text-dark-400 hover:text-primary-400 hover:bg-dark-700 rounded-lg transition-colors"
                          title="Editar"
                        >
                          <Edit2 className="w-4 h-4" />
                        </button>
                        {os.status === 'orcamento' && (
                          <button
                            onClick={() => handleStatusChange(os.id, 'aprovado')}
                            className="p-2 text-dark-400 hover:text-green-400 hover:bg-dark-700 rounded-lg transition-colors"
                            title="Aprovar"
                          >
                            <Check className="w-4 h-4" />
                          </button>
                        )}
                        <button
                          onClick={() => handleDelete(os.id)}
                          className="p-2 text-dark-400 hover:text-red-400 hover:bg-dark-700 rounded-lg transition-colors"
                          title="Excluir"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Modal de Cria√ß√£o/Edi√ß√£o */}
      <Modal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        title={editingOS ? `Editar Or√ßamento #${editingOS.numero}` : 'Novo Or√ßamento'}
        size="xl"
      >
        <form onSubmit={handleSubmit} className="space-y-6">
          {formError && (
            <div className="p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm flex items-center gap-2">
              <AlertTriangle className="w-4 h-4" />
              {formError}
            </div>
          )}

          {/* Dados do Cliente */}
          <div className="space-y-4">
            <h3 className="text-lg font-semibold text-white flex items-center gap-2">
              <User className="w-5 h-5 text-primary-400" />
              Dados do Cliente
            </h3>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="md:col-span-2 relative">
                <label className="block text-sm text-dark-300 mb-2">Cliente *</label>
                <input
                  type="text"
                  value={clienteSearch}
                  onChange={(e) => {
                    setClienteSearch(e.target.value)
                    setFormData({ ...formData, cliente_nome: e.target.value, cliente_id: null })
                    setShowClienteDropdown(true)
                  }}
                  onFocus={() => setShowClienteDropdown(true)}
                  placeholder="Digite o nome do cliente..."
                  className="input w-full"
                />
                {showClienteDropdown && clienteSearch && (
                  <div className="absolute z-20 w-full mt-1 bg-dark-800 border border-dark-600 rounded-lg shadow-lg max-h-48 overflow-y-auto">
                    {filteredClientes.length === 0 ? (
                      <div className="p-3 text-dark-400 text-sm">Nenhum cliente encontrado</div>
                    ) : (
                      filteredClientes.map((cliente) => (
                        <button
                          key={cliente.id}
                          type="button"
                          onClick={() => selectCliente(cliente)}
                          className="w-full p-3 text-left hover:bg-dark-700 text-white border-b border-dark-700 last:border-0"
                        >
                          <div className="font-medium">
                            {cliente.tipo_pessoa === 'PF' ? cliente.nome : cliente.razao_social}
                          </div>
                          <div className="text-xs text-dark-400">
                            {cliente.tipo_pessoa === 'PF' ? cliente.cpf : cliente.cnpj}
                          </div>
                        </button>
                      ))
                    )}
                  </div>
                )}
              </div>
              
              <div>
                <label className="block text-sm text-dark-300 mb-2">Tipo Atendimento</label>
                <select
                  value={formData.tipo_atendimento}
                  onChange={(e) => setFormData({ ...formData, tipo_atendimento: e.target.value })}
                  className="input w-full"
                >
                  <option value="Externo">Externo</option>
                  <option value="Interno">Interno</option>
                  <option value="Remoto">Remoto</option>
                </select>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label className="block text-sm text-dark-300 mb-2">Data da OS</label>
                <input
                  type="date"
                  value={formData.data_os}
                  onChange={(e) => setFormData({ ...formData, data_os: e.target.value })}
                  className="input w-full"
                />
              </div>
              <div>
                <label className="block text-sm text-dark-300 mb-2">Data de Entrega</label>
                <input
                  type="date"
                  value={formData.data_entrega}
                  onChange={(e) => setFormData({ ...formData, data_entrega: e.target.value })}
                  className="input w-full"
                />
              </div>
              <div>
                <label className="block text-sm text-dark-300 mb-2">Garantia (dias)</label>
                <input
                  type="number"
                  value={formData.garantia_dias}
                  onChange={(e) => setFormData({ ...formData, garantia_dias: Number(e.target.value) })}
                  className="input w-full"
                />
              </div>
            </div>
          </div>

          {/* Servi√ßos */}
          <div className="space-y-4">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                <Wrench className="w-5 h-5 text-yellow-400" />
                Servi√ßos Executados
              </h3>
              <Button type="button" variant="secondary" size="sm" onClick={addServico}>
                <Plus className="w-4 h-4" />
              </Button>
            </div>
            
            <div className="space-y-2">
              <div className="grid grid-cols-12 gap-2 text-xs text-dark-400 px-2">
                <div className="col-span-6">Descri√ß√£o</div>
                <div className="col-span-2">Horas/Qtde</div>
                <div className="col-span-2">Valor Unit.</div>
                <div className="col-span-1">Total</div>
                <div className="col-span-1"></div>
              </div>
              
              {servicos.map((servico, index) => (
                <div key={index} className="grid grid-cols-12 gap-2 items-center">
                  <div className="col-span-6">
                    <input
                      type="text"
                      value={servico.descricao}
                      onChange={(e) => updateServico(index, 'descricao', e.target.value)}
                      placeholder="Descri√ß√£o do servi√ßo..."
                      className="input w-full text-sm"
                    />
                  </div>
                  <div className="col-span-2">
                    <input
                      type="number"
                      step="0.5"
                      value={servico.quantidade || ''}
                      onChange={(e) => updateServico(index, 'quantidade', Number(e.target.value))}
                      className="input w-full text-sm text-center"
                    />
                  </div>
                  <div className="col-span-2">
                    <input
                      type="number"
                      step="0.01"
                      value={servico.valor_unitario || ''}
                      onChange={(e) => updateServico(index, 'valor_unitario', Number(e.target.value))}
                      className="input w-full text-sm text-right"
                    />
                  </div>
                  <div className="col-span-1 text-right text-white font-medium text-sm">
                    {formatCurrency(servico.valor_total || 0)}
                  </div>
                  <div className="col-span-1 text-center">
                    <button
                      type="button"
                      onClick={() => removeServico(index)}
                      className="p-1 text-dark-400 hover:text-red-400"
                      disabled={servicos.length === 1}
                    >
                      <X className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Produtos */}
          <div className="space-y-4">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                <Package className="w-5 h-5 text-blue-400" />
                Produtos Utilizados
              </h3>
              <Button type="button" variant="secondary" size="sm" onClick={addProduto}>
                <Plus className="w-4 h-4" />
              </Button>
            </div>
            
            {produtosOS.length > 0 && (
              <div className="space-y-2">
                <div className="grid grid-cols-12 gap-2 text-xs text-dark-400 px-2">
                  <div className="col-span-1">C√≥digo</div>
                  <div className="col-span-4">Descri√ß√£o</div>
                  <div className="col-span-1">Unid.</div>
                  <div className="col-span-2">Qtde</div>
                  <div className="col-span-2">Valor Unit.</div>
                  <div className="col-span-1">Total</div>
                  <div className="col-span-1"></div>
                </div>
                
                {produtosOS.map((produto, index) => (
                  <div key={index} className="grid grid-cols-12 gap-2 items-center relative">
                    <div className="col-span-1">
                      <input
                        type="text"
                        value={produto.codigo || ''}
                        onChange={(e) => updateProduto(index, 'codigo', e.target.value)}
                        className="input w-full text-xs"
                        placeholder="C√≥d"
                      />
                    </div>
                    <div className="col-span-4 relative">
                      <input
                        type="text"
                        value={produto.descricao}
                        onChange={(e) => {
                          updateProduto(index, 'descricao', e.target.value)
                          setProdutoSearch(e.target.value)
                          setSelectedProdutoIndex(index)
                          setShowProdutoDropdown(true)
                        }}
                        onFocus={() => {
                          setSelectedProdutoIndex(index)
                          if (produto.descricao) {
                            setProdutoSearch(produto.descricao)
                          }
                        }}
                        placeholder="Buscar produto..."
                        className="input w-full text-sm"
                      />
                      {showProdutoDropdown && selectedProdutoIndex === index && produtoSearch && (
                        <div className="absolute z-20 w-full mt-1 bg-dark-800 border border-dark-600 rounded-lg shadow-lg max-h-48 overflow-y-auto">
                          {filteredProdutos.length === 0 ? (
                            <div className="p-2 text-dark-400 text-xs">Nenhum produto encontrado</div>
                          ) : (
                            filteredProdutos.map((p) => (
                              <button
                                key={p.id}
                                type="button"
                                onClick={() => selectProduto(p)}
                                className="w-full p-2 text-left hover:bg-dark-700 text-white text-sm border-b border-dark-700 last:border-0"
                              >
                                <div className="flex justify-between">
                                  <span>{p.nome}</span>
                                  <span className="text-green-400">{formatCurrency(p.valor_venda)}</span>
                                </div>
                                <div className="text-xs text-dark-400">{p.codigo} - {p.unidade}</div>
                              </button>
                            ))
                          )}
                        </div>
                      )}
                    </div>
                    <div className="col-span-1">
                      <input
                        type="text"
                        value={produto.unidade}
                        onChange={(e) => updateProduto(index, 'unidade', e.target.value)}
                        className="input w-full text-xs text-center"
                      />
                    </div>
                    <div className="col-span-2">
                      <input
                        type="number"
                        step="0.001"
                        value={produto.quantidade || ''}
                        onChange={(e) => updateProduto(index, 'quantidade', Number(e.target.value))}
                        className="input w-full text-sm text-center"
                      />
                    </div>
                    <div className="col-span-2">
                      <input
                        type="number"
                        step="0.01"
                        value={produto.valor_unitario || ''}
                        onChange={(e) => updateProduto(index, 'valor_unitario', Number(e.target.value))}
                        className="input w-full text-sm text-right"
                      />
                    </div>
                    <div className="col-span-1 text-right text-white font-medium text-sm">
                      {formatCurrency(produto.valor_total || 0)}
                    </div>
                    <div className="col-span-1 text-center">
                      <button
                        type="button"
                        onClick={() => removeProduto(index)}
                        className="p-1 text-dark-400 hover:text-red-400"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Totais */}
          <div className="bg-dark-800 rounded-lg p-4 space-y-2">
            <div className="flex justify-between text-sm">
              <span className="text-dark-400">Total Servi√ßos:</span>
              <span className="text-white">{formatCurrency(totais.totalServicos)}</span>
            </div>
            <div className="flex justify-between text-sm">
              <span className="text-dark-400">Total Produtos:</span>
              <span className="text-white">{formatCurrency(totais.totalProdutos)}</span>
            </div>
            {totais.desconto > 0 && (
              <div className="flex justify-between text-sm">
                <span className="text-dark-400">Desconto:</span>
                <span className="text-red-400">-{formatCurrency(totais.desconto)}</span>
              </div>
            )}
            <div className="flex justify-between text-lg font-bold border-t border-dark-600 pt-2">
              <span className="text-white">TOTAL:</span>
              <span className="text-green-400">{formatCurrency(totais.total)}</span>
            </div>
          </div>

          {/* Observa√ß√µes */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm text-dark-300 mb-2">Observa√ß√µes (aparece na impress√£o)</label>
              <textarea
                value={formData.observacoes}
                onChange={(e) => setFormData({ ...formData, observacoes: e.target.value })}
                className="input w-full h-24"
                placeholder="Observa√ß√µes para o cliente..."
              />
            </div>
            <div>
              <label className="block text-sm text-dark-300 mb-2">Observa√ß√µes Internas</label>
              <textarea
                value={formData.observacoes_internas}
                onChange={(e) => setFormData({ ...formData, observacoes_internas: e.target.value })}
                className="input w-full h-24"
                placeholder="Observa√ß√µes internas (n√£o aparece na impress√£o)..."
              />
            </div>
          </div>

          {/* Bot√µes */}
          <div className="flex justify-end gap-3 pt-4 border-t border-dark-700">
            <Button type="button" variant="secondary" onClick={() => setIsModalOpen(false)}>
              Cancelar
            </Button>
            <Button type="submit" disabled={saving}>
              {saving ? 'Salvando...' : editingOS ? 'Atualizar' : 'Criar OS'}
            </Button>
          </div>
        </form>
      </Modal>
    </div>
  )
}
